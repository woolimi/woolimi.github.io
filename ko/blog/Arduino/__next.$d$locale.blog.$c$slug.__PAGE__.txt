1:"$Sreact.fragment"
2:I[935,["1921","static/chunks/79812939-dd468ad34b0555ab.js","2969","static/chunks/8fdae66b-3313d3073a4d6626.js","9991","static/chunks/9991-ccaf069d2d1a3394.js","650","static/chunks/650-f48a6caa28b58c59.js","7285","static/chunks/7285-e0b078d0c178a272.js","2061","static/chunks/2061-28fac52e9cc6c1cf.js","1283","static/chunks/1283-41499aa8a4a2d40d.js","5441","static/chunks/5441-6139f8dec0b22e57.js","5784","static/chunks/app/%5Blocale%5D/blog/%5B...slug%5D/page-b33400911b20deaf.js"],"default"]
3:I[26334,["1921","static/chunks/79812939-dd468ad34b0555ab.js","2969","static/chunks/8fdae66b-3313d3073a4d6626.js","9991","static/chunks/9991-ccaf069d2d1a3394.js","650","static/chunks/650-f48a6caa28b58c59.js","7285","static/chunks/7285-e0b078d0c178a272.js","2061","static/chunks/2061-28fac52e9cc6c1cf.js","1283","static/chunks/1283-41499aa8a4a2d40d.js","5441","static/chunks/5441-6139f8dec0b22e57.js","5784","static/chunks/app/%5Blocale%5D/blog/%5B...slug%5D/page-b33400911b20deaf.js"],"BlurFade"]
4:I[25417,["1921","static/chunks/79812939-dd468ad34b0555ab.js","2969","static/chunks/8fdae66b-3313d3073a4d6626.js","9991","static/chunks/9991-ccaf069d2d1a3394.js","650","static/chunks/650-f48a6caa28b58c59.js","7285","static/chunks/7285-e0b078d0c178a272.js","2061","static/chunks/2061-28fac52e9cc6c1cf.js","1283","static/chunks/1283-41499aa8a4a2d40d.js","5441","static/chunks/5441-6139f8dec0b22e57.js","5784","static/chunks/app/%5Blocale%5D/blog/%5B...slug%5D/page-b33400911b20deaf.js"],"BlogArticleCard"]
13:I[64725,[],"OutletBoundary"]
14:"$Sreact.suspense"
:HL["/_next/static/css/911e6a603adbdfb3.css","style"]
5:T743,<h2 id="필요-저항"><a class="heading-link" aria-hidden="true" href="#필요-저항">필요 저항</a></h2>
<ul>
<li>스위치 10KΩ</li>
<li>조도센서 10KΩ</li>
<li>LED 220Ω</li>
<li>7 Segment: 220Ω * 7 개</li>
</ul>
<h2 id="analog-vs-digital"><a class="heading-link" aria-hidden="true" href="#analog-vs-digital">Analog vs Digital</a></h2>
<table>
<thead>
<tr>
<th>구분</th>
<th>Digital</th>
<th>Analog</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>신호 형태</strong></td>
<td>0 또는 1 (HIGH/LOW)</td>
<td>연속적인 값 (0~1023)</td>
</tr>
<tr>
<td><strong>핀 번호</strong></td>
<td>D0~D13</td>
<td>A0~A5</td>
</tr>
<tr>
<td><strong>입력 함수</strong></td>
<td><code>digitalRead()</code></td>
<td><code>analogRead()</code></td>
</tr>
<tr>
<td><strong>출력 함수</strong></td>
<td><code>digitalWrite()</code></td>
<td><code>analogWrite()</code> (PWM 핀만)</td>
</tr>
<tr>
<td><strong>입력 값 범위</strong></td>
<td>0 또는 1</td>
<td>0~1023 (10bit)</td>
</tr>
<tr>
<td><strong>출력 값 범위</strong></td>
<td>LOW(0V) / HIGH(5V)</td>
<td>0~255 (8bit, PWM)</td>
</tr>
<tr>
<td><strong>사용 예시</strong></td>
<td>버튼, LED 온/오프, 릴레이</td>
<td>조도센서, 온도센서, 가변저항</td>
</tr>
<tr>
<td><strong>전압</strong></td>
<td>0V 또는 5V</td>
<td>0V~5V 연속</td>
</tr>
</tbody>
</table>
<h2 id="pwm-이란"><a class="heading-link" aria-hidden="true" href="#pwm-이란">PWM 이란</a></h2>
<p>아두이노에서 digital핀 중, <code>~</code>로 표시되어있는 부분은 디지털 신호로 아날로그의 연속적인 값을 흉내낼 수 있다. 해당 핀은 PWM (펄스 폭 변조: Pulse Width Modulation)은 디지털 신호를 아날로그 신호로 변환하는 방법 중 하나로, 펄스의 폭을 조절하여 아날로그 신호와 유사한 신호를 만들어낸다.</p>0:{"buildId":"7wrLch1PHmN9S3I0q82uc","rsc":["$","$1","c",{"children":[["$","section",null,{"id":"blog","className":"mb-30","children":[["$","nav",null,{"aria-label":"breadcrumb","data-slot":"breadcrumb","className":"mb-6","children":["$","ol",null,{"data-slot":"breadcrumb-list","className":"text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5","children":[["$","li","item-0",{"data-slot":"breadcrumb-item","className":"inline-flex items-center gap-1.5","children":["$","$L2",null,{"ref":null,"href":"/ko","localeCookie":{"name":"NEXT_LOCALE","sameSite":"lax"},"children":"Home","data-slot":"breadcrumb-link","className":"hover:text-foreground transition-colors"}]}],["$","li","separator-1",{"data-slot":"breadcrumb-separator","role":"presentation","aria-hidden":"true","className":"[&>svg]:size-3.5","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-chevron-right","aria-hidden":"true","children":[["$","path","mthhwq",{"d":"m9 18 6-6-6-6"}],"$undefined"]}]}],["$","li","item-1",{"data-slot":"breadcrumb-item","className":"inline-flex items-center gap-1.5","children":["$","$L2",null,{"ref":null,"href":"/ko/blog","localeCookie":{"name":"NEXT_LOCALE","sameSite":"lax"},"children":"Blog","data-slot":"breadcrumb-link","className":"hover:text-foreground transition-colors"}]}],["$","li","separator-2",{"data-slot":"breadcrumb-separator","role":"presentation","aria-hidden":"true","className":"[&>svg]:size-3.5","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-chevron-right","aria-hidden":"true","children":[["$","path","mthhwq",{"d":"m9 18 6-6-6-6"}],"$undefined"]}]}],["$","li","item-2",{"data-slot":"breadcrumb-item","className":"inline-flex items-center gap-1.5","children":["$","$L2",null,{"ref":null,"href":"/ko/blog/Arduino","localeCookie":{"name":"NEXT_LOCALE","sameSite":"lax"},"children":"Arduino","data-slot":"breadcrumb-link","className":"hover:text-foreground transition-colors"}]}]]}]}],["$","$L3",null,{"delay":0.04,"children":["$","h1",null,{"className":"mb-8 text-2xl font-bold tracking-normal","style":{"fontFamily":"var(--font-playfair), serif"},"children":"Arduino"}]}],["$","div",null,{"className":"grid grid-cols-1 gap-4 sm:grid-cols-2","children":[["$","$L4","Arduino/arduino",{"post":{"metadata":{"title":"Arduino 기본 지식","summary":"아두이노 입문자를 위한 기본 지식 정리. 필요 저항값, Digital/Analog 신호 차이점, PWM 개념을 다룹니다.","locale":"ko","createdAt":"2026-02-28T15:00:00.000Z","updatedAt":"2026-01-05T08:42:29.000Z"},"slug":"Arduino/arduino","source":"$5","type":"markdown","parentFolder":"Arduino"},"locale":"ko","delay":0.08}],"$L6","$L7","$L8","$L9","$La"]}],"$Lb"]}],["$Lc"],"$Ld"]}],"loading":null,"isPartial":false}
e:T6a8c,<p>아두이노를 사용하면서 스위치(버튼)을 제어할때 자주 사용하는 코드를 정리.</p>
<h2 id="스위치-회로도"><a class="heading-link" aria-hidden="true" href="#스위치-회로도">스위치 회로도</a></h2>
<p><img src="/switch.png" alt="switch"></p>
<h2 id="라이브러리"><a class="heading-link" aria-hidden="true" href="#라이브러리">라이브러리</a></h2>
<ul>
<li>SwitchButton.h</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#86E1FC">#ifndef</span><span style="color:#82AAFF"> SWITCH_BUTTON_H</span></span>
<span data-line=""><span style="color:#86E1FC">#define</span><span style="color:#82AAFF"> SWITCH_BUTTON_H</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">#include</span><span style="color:#86E1FC"> &#x3C;</span><span style="color:#C3E88D">Arduino.h</span><span style="color:#86E1FC">></span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 스위치 버튼 클래스 (debounce 포함)</span></span>
<span data-line=""><span style="color:#C099FF">class</span><span style="color:#FFC777"> SwitchButton</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#C099FF">private</span><span style="color:#86E1FC">:</span></span>
<span data-line=""><span style="color:#B4C2F0">  byte pin</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#C099FF">  unsigned</span><span style="color:#C099FF"> long</span><span style="color:#B4C2F0"> debounceDelay</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#C099FF">  bool</span><span style="color:#B4C2F0"> lastState</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#C099FF">  bool</span><span style="color:#B4C2F0"> currentState</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#C099FF">  unsigned</span><span style="color:#C099FF"> long</span><span style="color:#B4C2F0"> lastDebounceTime</span><span style="color:#86E1FC">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">public</span><span style="color:#86E1FC">:</span></span>
<span data-line=""><span style="color:#858AA6">  // 생성자: 핀 번호와 debounce 지연 시간 설정 (기본값: 50ms)</span></span>
<span data-line=""><span style="color:#82AAFF">  SwitchButton</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">byte</span><span style="color:#FCA7EA"> pin</span><span style="color:#86E1FC">,</span><span style="color:#C099FF"> unsigned</span><span style="color:#C099FF"> long</span><span style="color:#FCA7EA"> debounceDelay</span><span style="color:#86E1FC"> =</span><span style="color:#FF966C"> 50</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 초기화: 핀 모드를 INPUT_PULLUP으로 설정</span></span>
<span data-line=""><span style="color:#C099FF">  void</span><span style="color:#82AAFF"> init</span><span style="color:#86E1FC">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 버튼 상태 체크: 눌림이 감지되면 true 반환</span></span>
<span data-line=""><span style="color:#858AA6">  // loop()에서 반복적으로 호출해야 함</span></span>
<span data-line=""><span style="color:#C099FF">  bool</span><span style="color:#82AAFF"> check</span><span style="color:#86E1FC">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 버튼이 눌렸는지 확인 (한 번만 true 반환)</span></span>
<span data-line=""><span style="color:#C099FF">  bool</span><span style="color:#82AAFF"> isPressed</span><span style="color:#86E1FC">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 현재 버튼 상태 반환</span></span>
<span data-line=""><span style="color:#C099FF">  bool</span><span style="color:#82AAFF"> getState</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#86E1FC">};</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">#endif</span></span><button type="button" title="Copy code" aria-label="Copy code" data="#ifndef SWITCH_BUTTON_H
#define SWITCH_BUTTON_H

#include <Arduino.h>

// 스위치 버튼 클래스 (debounce 포함)
class SwitchButton {
private:
  byte pin;
  unsigned long debounceDelay;
  bool lastState;
  bool currentState;
  unsigned long lastDebounceTime;

public:
  // 생성자: 핀 번호와 debounce 지연 시간 설정 (기본값: 50ms)
  SwitchButton(byte pin, unsigned long debounceDelay = 50);

  // 초기화: 핀 모드를 INPUT_PULLUP으로 설정
  void init();

  // 버튼 상태 체크: 눌림이 감지되면 true 반환
  // loop()에서 반복적으로 호출해야 함
  bool check();

  // 버튼이 눌렸는지 확인 (한 번만 true 반환)
  bool isPressed();

  // 현재 버튼 상태 반환
  bool getState();
};

#endif" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<ul>
<li>SwitchButton.cpp</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#86E1FC">#include</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">SwitchButton.h</span><span style="color:#86E1FC">"</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 생성자: 핀 번호와 debounce 지연 시간 설정</span></span>
<span data-line=""><span style="color:#FFC777">SwitchButton</span><span style="color:#86E1FC">::</span><span style="color:#82AAFF">SwitchButton</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">byte pin</span><span style="color:#86E1FC">,</span><span style="color:#C099FF"> unsigned</span><span style="color:#C099FF"> long</span><span style="color:#C8D3F5"> debounceDelay</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FF757F">  this</span><span style="color:#86E1FC">-></span><span style="color:#A9B8E8">pin</span><span style="color:#86E1FC"> =</span><span style="color:#B4C2F0"> pin</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#FF757F">  this</span><span style="color:#86E1FC">-></span><span style="color:#A9B8E8">debounceDelay</span><span style="color:#86E1FC"> =</span><span style="color:#B4C2F0"> debounceDelay</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#FF757F">  this</span><span style="color:#86E1FC">-></span><span style="color:#A9B8E8">lastState</span><span style="color:#86E1FC"> =</span><span style="color:#B4C2F0"> LOW</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#FF757F">  this</span><span style="color:#86E1FC">-></span><span style="color:#A9B8E8">currentState</span><span style="color:#86E1FC"> =</span><span style="color:#B4C2F0"> HIGH</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#FF757F">  this</span><span style="color:#86E1FC">-></span><span style="color:#A9B8E8">lastDebounceTime</span><span style="color:#86E1FC"> =</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 초기화: 핀 모드를 INPUT_PULLUP으로 설정하고 실제 상태로 초기화</span></span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#FFC777"> SwitchButton</span><span style="color:#86E1FC">::</span><span style="color:#82AAFF">init</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#82AAFF">  pinMode</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">pin</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> INPUT_PULLUP</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#858AA6">  // 실제 핀 상태를 읽어서 초기화 (버튼이 눌리지 않은 상태로 시작)</span></span>
<span data-line=""><span style="color:#C099FF">  int</span><span style="color:#C8D3F5"> reading </span><span style="color:#86E1FC">=</span><span style="color:#82AAFF"> digitalRead</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">pin</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FF757F">  this</span><span style="color:#86E1FC">-></span><span style="color:#A9B8E8">lastState</span><span style="color:#86E1FC"> =</span><span style="color:#C8D3F5"> reading</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#FF757F">  this</span><span style="color:#86E1FC">-></span><span style="color:#A9B8E8">currentState</span><span style="color:#86E1FC"> =</span><span style="color:#C8D3F5"> reading</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#FF757F">  this</span><span style="color:#86E1FC">-></span><span style="color:#A9B8E8">lastDebounceTime</span><span style="color:#86E1FC"> =</span><span style="color:#82AAFF"> millis</span><span style="color:#86E1FC">();</span><span style="color:#858AA6"> // debounce 타이머를 현재 시간으로 설정</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 버튼 상태 체크: 눌림이 감지되면 true 반환</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#FFC777"> SwitchButton</span><span style="color:#86E1FC">::</span><span style="color:#82AAFF">check</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#C099FF">  int</span><span style="color:#C8D3F5"> reading </span><span style="color:#86E1FC">=</span><span style="color:#82AAFF"> digitalRead</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">pin</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 초기화되지 않은 경우 (lastDebounceTime이 0이면) 초기화</span></span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">lastDebounceTime </span><span style="color:#86E1FC">==</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">    lastState </span><span style="color:#86E1FC">=</span><span style="color:#B4C2F0"> reading</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#B4C2F0">    currentState </span><span style="color:#86E1FC">=</span><span style="color:#B4C2F0"> reading</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#B4C2F0">    lastDebounceTime </span><span style="color:#86E1FC">=</span><span style="color:#82AAFF"> millis</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#86E1FC">    return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span><span style="color:#858AA6">  // 초기화 중이므로 버튼이 눌리지 않은 것으로 처리</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 상태가 변경되면 debounce 타이머 리셋</span></span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">reading </span><span style="color:#86E1FC">!=</span><span style="color:#C8D3F5"> lastState</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">    lastDebounceTime </span><span style="color:#86E1FC">=</span><span style="color:#82AAFF"> millis</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // debounce 시간이 지났는지 확인</span></span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> ((</span><span style="color:#82AAFF">millis</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> -</span><span style="color:#C8D3F5"> lastDebounceTime</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> ></span><span style="color:#C8D3F5"> debounceDelay</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#858AA6">    // 안정된 상태가 변경되었는지 확인</span></span>
<span data-line=""><span style="color:#86E1FC">    if</span><span style="color:#86E1FC"> (</span><span style="color:#B4C2F0">reading </span><span style="color:#86E1FC">!=</span><span style="color:#B4C2F0"> currentState</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">      currentState </span><span style="color:#86E1FC">=</span><span style="color:#B4C2F0"> reading</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#858AA6">      // 버튼이 눌렸을 때 (LOW = 눌림, HIGH = 안 눌림, INPUT_PULLUP 사용 시)</span></span>
<span data-line=""><span style="color:#86E1FC">      if</span><span style="color:#86E1FC"> (</span><span style="color:#B4C2F0">currentState </span><span style="color:#86E1FC">==</span><span style="color:#B4C2F0"> LOW</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">        lastState </span><span style="color:#86E1FC">=</span><span style="color:#B4C2F0"> reading</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">        return</span><span style="color:#FF98A4"> true</span><span style="color:#86E1FC">;</span><span style="color:#858AA6">  // 버튼이 눌림</span></span>
<span data-line=""><span style="color:#86E1FC">      }</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C8D3F5">  lastState </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> reading</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span><span style="color:#858AA6">  // 버튼이 눌리지 않음</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 버튼이 눌렸는지 확인 (한 번만 true 반환)</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#FFC777"> SwitchButton</span><span style="color:#86E1FC">::</span><span style="color:#82AAFF">isPressed</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#82AAFF"> check</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 현재 버튼 상태 반환</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#FFC777"> SwitchButton</span><span style="color:#86E1FC">::</span><span style="color:#82AAFF">getState</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#C8D3F5"> currentState</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""> </span><button type="button" title="Copy code" aria-label="Copy code" data="#include &#x22;SwitchButton.h&#x22;

// 생성자: 핀 번호와 debounce 지연 시간 설정
SwitchButton::SwitchButton(byte pin, unsigned long debounceDelay) {
  this->pin = pin;
  this->debounceDelay = debounceDelay;
  this->lastState = LOW;
  this->currentState = HIGH;
  this->lastDebounceTime = 0;
}

// 초기화: 핀 모드를 INPUT_PULLUP으로 설정하고 실제 상태로 초기화
void SwitchButton::init() {
  pinMode(pin, INPUT_PULLUP);
  // 실제 핀 상태를 읽어서 초기화 (버튼이 눌리지 않은 상태로 시작)
  int reading = digitalRead(pin);
  this->lastState = reading;
  this->currentState = reading;
  this->lastDebounceTime = millis(); // debounce 타이머를 현재 시간으로 설정
}

// 버튼 상태 체크: 눌림이 감지되면 true 반환
bool SwitchButton::check() {
  int reading = digitalRead(pin);

  // 초기화되지 않은 경우 (lastDebounceTime이 0이면) 초기화
  if (lastDebounceTime == 0) {
    lastState = reading;
    currentState = reading;
    lastDebounceTime = millis();
    return false;  // 초기화 중이므로 버튼이 눌리지 않은 것으로 처리
  }

  // 상태가 변경되면 debounce 타이머 리셋
  if (reading != lastState) {
    lastDebounceTime = millis();
  }

  // debounce 시간이 지났는지 확인
  if ((millis() - lastDebounceTime) > debounceDelay) {
    // 안정된 상태가 변경되었는지 확인
    if (reading != currentState) {
      currentState = reading;
      // 버튼이 눌렸을 때 (LOW = 눌림, HIGH = 안 눌림, INPUT_PULLUP 사용 시)
      if (currentState == LOW) {
        lastState = reading;
        return true;  // 버튼이 눌림
      }
    }
  }

  lastState = reading;
  return false;  // 버튼이 눌리지 않음
}

// 버튼이 눌렸는지 확인 (한 번만 true 반환)
bool SwitchButton::isPressed() {
  return check();
}

// 현재 버튼 상태 반환
bool SwitchButton::getState() {
  return currentState;
}

" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<ul>
<li>사용법</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#86E1FC">#include</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">SwitchButton.h</span><span style="color:#86E1FC">"</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 스위치 버튼 객체 생성</span></span>
<span data-line=""><span style="color:#FFC777">SwitchButton</span><span style="color:#82AAFF"> switchButton</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">SWITCH_PIN</span><span style="color:#86E1FC">,</span><span style="color:#FF966C"> 50</span><span style="color:#86E1FC">);</span><span style="color:#858AA6">  // 핀 번호, debounce delay (ms)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> setup</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#858AA6">  // 스위치 버튼 초기화</span></span>
<span data-line=""><span style="color:#FFC777">  switchButton</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">init</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> loop</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> (</span><span style="color:#FFC777">switchButton</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">check</span><span style="color:#86E1FC">())</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#858AA6">    // do something...</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="#include &#x22;SwitchButton.h&#x22;

// 스위치 버튼 객체 생성
SwitchButton switchButton(SWITCH_PIN, 50);  // 핀 번호, debounce delay (ms)

void setup() {
  // 스위치 버튼 초기화
  switchButton.init();
}

void loop() {
  if (switchButton.check()) {
    // do something...
  }
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>6:["$","$L4","Arduino/switch",{"post":{"metadata":{"title":"Arduino Switch","summary":"아두이노에서 스위치(버튼)을 처리할때 자주 사용하는 코드","locale":"ko","createdAt":"2026-02-28T15:00:00.000Z","updatedAt":"2026-01-07T00:43:52.000Z"},"slug":"Arduino/switch","source":"$e","type":"markdown","parentFolder":"Arduino"},"locale":"ko","delay":0.13}]
f:T1ede,<h2 id="serial-통신-시작"><a class="heading-link" aria-hidden="true" href="#serial-통신-시작">Serial 통신 시작</a></h2>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> setup</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">	Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">begin</span><span style="color:#86E1FC">(</span><span style="color:#FF966C">9600</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> loop</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">	Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">...</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="void setup() {
	Serial.begin(9600);
}
void loop() {
	Serial.println(&#x22;...&#x22;);
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<h2 id="한-문장을-읽기"><a class="heading-link" aria-hidden="true" href="#한-문장을-읽기">한 문장을 읽기</a></h2>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> loop</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">	while</span><span style="color:#86E1FC"> (</span><span style="color:#FFC777">Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">available</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> ></span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">		String input </span><span style="color:#86E1FC">=</span><span style="color:#FFC777"> Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">readStringUntil</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">'\n'</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">		Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">input</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">		// 받은 문자열을 숫자로 변환</span></span>
<span data-line=""><span style="color:#C099FF">		int</span><span style="color:#B4C2F0"> degree </span><span style="color:#86E1FC">=</span><span style="color:#FFC777"> input</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">toInt</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#86E1FC">	}</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="void loop() {
	while (Serial.available() > 0) {
		String input = Serial.readStringUntil(&#x27;\n&#x27;);
		Serial.println(input);

		// 받은 문자열을 숫자로 변환
		int degree = input.toInt();
	}
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>7:["$","$L4","Arduino/serial",{"post":{"metadata":{"title":"Arduino 시리얼로 입력값을 받기","summary":"아두이노 시리얼 통신으로 데이터 수신 방법 정리. Serial.begin(), Serial.readStringUntil() 사용법과 문자열을 숫자로 변환하는 방법 다룸.","locale":"ko","createdAt":"2026-02-28T15:00:00.000Z","updatedAt":"2026-01-05T08:42:29.000Z"},"slug":"Arduino/serial","source":"$f","type":"markdown","parentFolder":"Arduino"},"locale":"ko","delay":0.18}]
10:Tdd39,<h2 id="개요"><a class="heading-link" aria-hidden="true" href="#개요">개요</a></h2>
<p>Ollama를 사용한 로컬 LLM과 Python을 통해 아두이노를 제어할 수 있다. LLM이 사용자의 입력을 분석하고, 그 결과를 시리얼 통신으로 아두이노에 전달하여 하드웨어를 제어한다.</p>
<h2 id="시스템-구조"><a class="heading-link" aria-hidden="true" href="#시스템-구조">시스템 구조</a></h2>
<pre><code>사용자 입력 → Python (Ollama API) → LLM 분석 → 시리얼 통신 → Arduino
</code></pre>
<ol>
<li><strong>Python 스크립트</strong>: 사용자 입력을 받아 Ollama API를 호출</li>
<li><strong>Ollama LLM</strong>: 로컬에서 실행되는 대규모 언어 모델</li>
<li><strong>시리얼 통신</strong>: Python과 아두이노 간 데이터 전송</li>
<li><strong>Arduino</strong>: 하드웨어 제어</li>
</ol>
<h2 id="사전-준비"><a class="heading-link" aria-hidden="true" href="#사전-준비">사전 준비</a></h2>
<h3 id="1-ollama-설치-및-모델-다운로드"><a class="heading-link" aria-hidden="true" href="#1-ollama-설치-및-모델-다운로드">1. Ollama 설치 및 모델 다운로드</a></h3>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="bash" data-theme="moonlight-ii"><code data-language="bash" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#858AA6"># Ollama 설치 (https://ollama.ai)</span></span>
<span data-line=""><span style="color:#858AA6"># 모델 다운로드</span></span>
<span data-line=""><span style="color:#FFC777">ollama</span><span style="color:#C3E88D"> pull</span><span style="color:#C3E88D"> llama3.2:latest</span></span><button type="button" title="Copy code" aria-label="Copy code" data="# Ollama 설치 (https://ollama.ai)
# 모델 다운로드
ollama pull llama3.2:latest" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<h3 id="2-python-라이브러리-설치"><a class="heading-link" aria-hidden="true" href="#2-python-라이브러리-설치">2. Python 라이브러리 설치</a></h3>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="bash" data-theme="moonlight-ii"><code data-language="bash" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#FFC777">pip</span><span style="color:#C3E88D"> install</span><span style="color:#C3E88D"> requests</span><span style="color:#C3E88D"> pyserial</span></span><button type="button" title="Copy code" aria-label="Copy code" data="pip install requests pyserial" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<h3 id="3-arduino-시리얼-통신-준비"><a class="heading-link" aria-hidden="true" href="#3-arduino-시리얼-통신-준비">3. Arduino 시리얼 통신 준비</a></h3>
<p>아두이노는 시리얼 통신을 통해 명령을 받을 수 있도록 설정되어 있어야 한다.</p>
<h2 id="python-코드"><a class="heading-link" aria-hidden="true" href="#python-코드">Python 코드</a></h2>
<h3 id="기본-구조"><a class="heading-link" aria-hidden="true" href="#기본-구조">기본 구조</a></h3>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="python" data-theme="moonlight-ii"><code data-language="python" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#86E1FC">import</span><span style="color:#C8D3F5"> requests</span></span>
<span data-line=""><span style="color:#86E1FC">import</span><span style="color:#C8D3F5"> json</span></span>
<span data-line=""><span style="color:#86E1FC">import</span><span style="color:#C8D3F5"> serial</span></span>
<span data-line=""><span style="color:#86E1FC">import</span><span style="color:#C8D3F5"> time</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6"># Ollama 설정</span></span>
<span data-line=""><span style="color:#C8D3F5">OLLAMA_URL </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">http://localhost:11434/api/chat</span><span style="color:#86E1FC">"</span></span>
<span data-line=""><span style="color:#C8D3F5">MODEL </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">llama3.2:latest</span><span style="color:#86E1FC">"</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6"># 시리얼 통신 설정</span></span>
<span data-line=""><span style="color:#C8D3F5">SERIAL_PORT </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">/dev/ttyACM0</span><span style="color:#86E1FC">"</span><span style="color:#858AA6">  # Linux/Mac</span></span>
<span data-line=""><span style="color:#858AA6"># SERIAL_PORT = "COM3"        # Windows</span></span>
<span data-line=""><span style="color:#C8D3F5">BAUD </span><span style="color:#86E1FC">=</span><span style="color:#FF966C"> 9600</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6"># 시스템 프롬프트: LLM이 아두이노 제어 명령을 생성하도록 지시</span></span>
<span data-line=""><span style="color:#C8D3F5">SYSTEM_PROMPT </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> """</span><span style="color:#C3E88D">사용자의 요청을 분석하여 아두이노 제어 명령을 생성하세요.</span></span>
<span data-line=""><span style="color:#C3E88D">명령 형식: LED_ON, LED_OFF, MOTOR_START, MOTOR_STOP 등</span></span>
<span data-line=""><span style="color:#C3E88D">JSON 형식으로 응답하세요: {"command": "명령어", "reply": "사용자에게 보여줄 응답"}</span></span>
<span data-line=""><span style="color:#86E1FC">"""</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">def</span><span style="color:#82AAFF"> call_ollama</span><span style="color:#B4C2F0">(</span><span style="color:#FCA7EA">user_input</span><span style="color:#86E1FC">:</span><span style="color:#FF966C"> str</span><span style="color:#B4C2F0">)</span><span style="color:#86E1FC"> -></span><span style="color:#FF966C"> dict</span><span style="color:#B4C2F0">:</span></span>
<span data-line=""><span style="color:#86E1FC">    """</span><span style="color:#858AA6">Ollama API를 호출하여 응답을 받는다.</span><span style="color:#86E1FC">"""</span></span>
<span data-line=""><span style="color:#C8D3F5">    payload </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">        "</span><span style="color:#C3E88D">model</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#C8D3F5"> MODEL</span><span style="color:#86E1FC">,</span></span>
<span data-line=""><span style="color:#86E1FC">        "</span><span style="color:#C3E88D">messages</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> [</span></span>
<span data-line=""><span style="color:#858AA6">            # role 옵션: "system" (시스템 프롬프트), "user" (사용자 입력), "assistant" (LLM 응답)</span></span>
<span data-line=""><span style="color:#86E1FC">            {</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">role</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">system</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">content</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#C8D3F5"> SYSTEM_PROMPT</span><span style="color:#86E1FC">},</span><span style="color:#858AA6">  # 시스템 프롬프트: LLM의 역할과 동작 방식 정의</span></span>
<span data-line=""><span style="color:#86E1FC">            {</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">role</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">user</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">content</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#C8D3F5"> user_input</span><span style="color:#86E1FC">}</span><span style="color:#858AA6">         # 사용자 입력</span></span>
<span data-line=""><span style="color:#86E1FC">        ],</span></span>
<span data-line=""><span style="color:#86E1FC">        "</span><span style="color:#C3E88D">stream</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#FF98A4"> False</span><span style="color:#86E1FC">,</span><span style="color:#858AA6">      # False: 전체 응답을 한 번에 받음, True: 실시간 스트리밍</span></span>
<span data-line=""><span style="color:#86E1FC">        "</span><span style="color:#C3E88D">format</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">json</span><span style="color:#86E1FC">"</span><span style="color:#858AA6">      # JSON 형식으로 응답 받기 (파싱 용이)</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C8D3F5">    response </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> requests</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">post</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">OLLAMA_URL</span><span style="color:#86E1FC">,</span><span style="color:#FCA7EA"> json</span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5">payload</span><span style="color:#86E1FC">,</span><span style="color:#FCA7EA"> timeout</span><span style="color:#86E1FC">=</span><span style="color:#FF966C">30</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#C8D3F5">    response</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">raise_for_status</span><span style="color:#86E1FC">()</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C8D3F5">    content </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> response</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">json</span><span style="color:#86E1FC">()[</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">message</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">][</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">content</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">]</span></span>
<span data-line=""><span style="color:#86E1FC">    return</span><span style="color:#C8D3F5"> json</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">loads</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">content</span><span style="color:#86E1FC">)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">def</span><span style="color:#82AAFF"> send_to_arduino</span><span style="color:#B4C2F0">(</span><span style="color:#FCA7EA">ser</span><span style="color:#86E1FC">:</span><span style="color:#C8D3F5"> serial</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">Serial</span><span style="color:#86E1FC">,</span><span style="color:#FCA7EA"> command</span><span style="color:#86E1FC">:</span><span style="color:#FF966C"> str</span><span style="color:#B4C2F0">):</span></span>
<span data-line=""><span style="color:#86E1FC">    """</span><span style="color:#858AA6">아두이노에 명령을 전송한다.</span><span style="color:#86E1FC">"""</span></span>
<span data-line=""><span style="color:#C8D3F5">    ser</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">write</span><span style="color:#86E1FC">((</span><span style="color:#C8D3F5">command </span><span style="color:#86E1FC">+</span><span style="color:#86E1FC"> "\n"</span><span style="color:#86E1FC">).</span><span style="color:#C8D3F5">encode</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">utf-8</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">))</span></span>
<span data-line=""><span style="color:#C8D3F5">    ser</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">flush</span><span style="color:#86E1FC">()</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">def</span><span style="color:#82AAFF"> main</span><span style="color:#B4C2F0">():</span></span>
<span data-line=""><span style="color:#858AA6">    # 시리얼 포트 열기</span></span>
<span data-line=""><span style="color:#C8D3F5">    ser </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> serial</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">Serial</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">SERIAL_PORT</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> BAUD</span><span style="color:#86E1FC">,</span><span style="color:#FCA7EA"> timeout</span><span style="color:#86E1FC">=</span><span style="color:#FF966C">1.0</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#C8D3F5">    time</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">sleep</span><span style="color:#86E1FC">(</span><span style="color:#FF966C">1.5</span><span style="color:#86E1FC">)</span><span style="color:#858AA6">  # 연결 대기</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#65BCFF">    print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">시스템 준비 완료. 명령을 입력하세요.</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">    while</span><span style="color:#FF98A4"> True</span><span style="color:#86E1FC">:</span></span>
<span data-line=""><span style="color:#C8D3F5">        user_input </span><span style="color:#86E1FC">=</span><span style="color:#65BCFF"> input</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"\n</span><span style="color:#C3E88D">입력> </span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">).</span><span style="color:#C8D3F5">strip</span><span style="color:#86E1FC">()</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">        if</span><span style="color:#C8D3F5"> user_input</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">lower</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> in</span><span style="color:#86E1FC"> (</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">quit</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">exit</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">):</span></span>
<span data-line=""><span style="color:#86E1FC">            break</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">        # LLM 호출</span></span>
<span data-line=""><span style="color:#C8D3F5">        result </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> call_ollama</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">user_input</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#C8D3F5">        command </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> result</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">get</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">command</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> ""</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#C8D3F5">        reply </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> result</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">get</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">reply</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> ""</span><span style="color:#86E1FC">)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">        # 아두이노에 명령 전송</span></span>
<span data-line=""><span style="color:#86E1FC">        if</span><span style="color:#C8D3F5"> command</span><span style="color:#86E1FC">:</span></span>
<span data-line=""><span style="color:#C8D3F5">            send_to_arduino</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">ser</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> command</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#65BCFF">            print</span><span style="color:#86E1FC">(</span><span style="color:#C099FF">f</span><span style="color:#C3E88D">"명령 전송: </span><span style="color:#FF98A4">{</span><span style="color:#C8D3F5">command</span><span style="color:#FF98A4">}</span><span style="color:#C3E88D">"</span><span style="color:#86E1FC">)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#65BCFF">        print</span><span style="color:#86E1FC">(</span><span style="color:#C099FF">f</span><span style="color:#C3E88D">"응답: </span><span style="color:#FF98A4">{</span><span style="color:#C8D3F5">reply</span><span style="color:#FF98A4">}</span><span style="color:#C3E88D">"</span><span style="color:#86E1FC">)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C8D3F5">    ser</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">close</span><span style="color:#86E1FC">()</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">if</span><span style="color:#C8D3F5"> __name__ </span><span style="color:#86E1FC">==</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">__main__</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span></span>
<span data-line=""><span style="color:#C8D3F5">    main</span><span style="color:#86E1FC">()</span></span><button type="button" title="Copy code" aria-label="Copy code" data="import requests
import json
import serial
import time

# Ollama 설정
OLLAMA_URL = &#x22;http://localhost:11434/api/chat&#x22;
MODEL = &#x22;llama3.2:latest&#x22;

# 시리얼 통신 설정
SERIAL_PORT = &#x22;/dev/ttyACM0&#x22;  # Linux/Mac
# SERIAL_PORT = &#x22;COM3&#x22;        # Windows
BAUD = 9600

# 시스템 프롬프트: LLM이 아두이노 제어 명령을 생성하도록 지시
SYSTEM_PROMPT = &#x22;&#x22;&#x22;사용자의 요청을 분석하여 아두이노 제어 명령을 생성하세요.
명령 형식: LED_ON, LED_OFF, MOTOR_START, MOTOR_STOP 등
JSON 형식으로 응답하세요: {&#x22;command&#x22;: &#x22;명령어&#x22;, &#x22;reply&#x22;: &#x22;사용자에게 보여줄 응답&#x22;}
&#x22;&#x22;&#x22;

def call_ollama(user_input: str) -> dict:
    &#x22;&#x22;&#x22;Ollama API를 호출하여 응답을 받는다.&#x22;&#x22;&#x22;
    payload = {
        &#x22;model&#x22;: MODEL,
        &#x22;messages&#x22;: [
            # role 옵션: &#x22;system&#x22; (시스템 프롬프트), &#x22;user&#x22; (사용자 입력), &#x22;assistant&#x22; (LLM 응답)
            {&#x22;role&#x22;: &#x22;system&#x22;, &#x22;content&#x22;: SYSTEM_PROMPT},  # 시스템 프롬프트: LLM의 역할과 동작 방식 정의
            {&#x22;role&#x22;: &#x22;user&#x22;, &#x22;content&#x22;: user_input}         # 사용자 입력
        ],
        &#x22;stream&#x22;: False,      # False: 전체 응답을 한 번에 받음, True: 실시간 스트리밍
        &#x22;format&#x22;: &#x22;json&#x22;      # JSON 형식으로 응답 받기 (파싱 용이)
    }

    response = requests.post(OLLAMA_URL, json=payload, timeout=30)
    response.raise_for_status()

    content = response.json()[&#x22;message&#x22;][&#x22;content&#x22;]
    return json.loads(content)

def send_to_arduino(ser: serial.Serial, command: str):
    &#x22;&#x22;&#x22;아두이노에 명령을 전송한다.&#x22;&#x22;&#x22;
    ser.write((command + &#x22;\n&#x22;).encode(&#x22;utf-8&#x22;))
    ser.flush()

def main():
    # 시리얼 포트 열기
    ser = serial.Serial(SERIAL_PORT, BAUD, timeout=1.0)
    time.sleep(1.5)  # 연결 대기

    print(&#x22;시스템 준비 완료. 명령을 입력하세요.&#x22;)

    while True:
        user_input = input(&#x22;\n입력> &#x22;).strip()

        if user_input.lower() in (&#x22;quit&#x22;, &#x22;exit&#x22;):
            break

        # LLM 호출
        result = call_ollama(user_input)
        command = result.get(&#x22;command&#x22;, &#x22;&#x22;)
        reply = result.get(&#x22;reply&#x22;, &#x22;&#x22;)

        # 아두이노에 명령 전송
        if command:
            send_to_arduino(ser, command)
            print(f&#x22;명령 전송: {command}&#x22;)

        print(f&#x22;응답: {reply}&#x22;)

    ser.close()

if __name__ == &#x22;__main__&#x22;:
    main()" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<h2 id="arduino-코드-예시"><a class="heading-link" aria-hidden="true" href="#arduino-코드-예시">Arduino 코드 예시</a></h2>
<p>아두이노는 시리얼 통신으로 명령을 받아 처리한다.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="cpp" data-theme="moonlight-ii"><code data-language="cpp" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> setup</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">begin</span><span style="color:#86E1FC">(</span><span style="color:#FF966C">9600</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#82AAFF">  pinMode</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">LED_BUILTIN</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> OUTPUT</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> loop</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> (</span><span style="color:#FFC777">Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">available</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> ></span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">    String command </span><span style="color:#86E1FC">=</span><span style="color:#FFC777"> Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">readStringUntil</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">'\n'</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">    command</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">trim</span><span style="color:#86E1FC">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">    if</span><span style="color:#86E1FC"> (</span><span style="color:#B4C2F0">command </span><span style="color:#86E1FC">==</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">LED_ON</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#82AAFF">      digitalWrite</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">LED_BUILTIN</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> HIGH</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">LED 켜짐</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""><span style="color:#86E1FC">    else</span><span style="color:#86E1FC"> if</span><span style="color:#86E1FC"> (</span><span style="color:#B4C2F0">command </span><span style="color:#86E1FC">==</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">LED_OFF</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#82AAFF">      digitalWrite</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">LED_BUILTIN</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> LOW</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">LED 꺼짐</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""><span style="color:#86E1FC">    else</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">알 수 없는 명령</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="void setup() {
  Serial.begin(9600);
  pinMode(LED_BUILTIN, OUTPUT);
}

void loop() {
  if (Serial.available() > 0) {
    String command = Serial.readStringUntil(&#x27;\n&#x27;);
    command.trim();

    if (command == &#x22;LED_ON&#x22;) {
      digitalWrite(LED_BUILTIN, HIGH);
      Serial.println(&#x22;LED 켜짐&#x22;);
    }
    else if (command == &#x22;LED_OFF&#x22;) {
      digitalWrite(LED_BUILTIN, LOW);
      Serial.println(&#x22;LED 꺼짐&#x22;);
    }
    else {
      Serial.println(&#x22;알 수 없는 명령&#x22;);
    }
  }
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<h2 id="동작-흐름"><a class="heading-link" aria-hidden="true" href="#동작-흐름">동작 흐름</a></h2>
<ol>
<li><strong>사용자 입력</strong>: "LED를 켜줘"</li>
<li><strong>LLM 분석</strong>: Python이 Ollama API를 호출하여 명령 분석</li>
<li><strong>명령 생성</strong>: LLM이 <code>{"command": "LED_ON", "reply": "LED를 켰습니다"}</code> 생성</li>
<li><strong>시리얼 전송</strong>: Python이 "LED_ON" 명령을 아두이노에 전송</li>
<li><strong>하드웨어 제어</strong>: 아두이노가 LED를 켜고 응답 전송</li>
</ol>
<h2 id="고급-기능"><a class="heading-link" aria-hidden="true" href="#고급-기능">고급 기능</a></h2>
<h3 id="대화-기록-유지"><a class="heading-link" aria-hidden="true" href="#대화-기록-유지">대화 기록 유지</a></h3>
<p>LLM이 이전 대화를 기억하도록 대화 기록을 유지할 수 있다.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="python" data-theme="moonlight-ii"><code data-language="python" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#C8D3F5">conversation_history </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> []</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">def</span><span style="color:#82AAFF"> call_ollama_with_history</span><span style="color:#B4C2F0">(</span><span style="color:#FCA7EA">user_input</span><span style="color:#86E1FC">:</span><span style="color:#FF966C"> str</span><span style="color:#B4C2F0">)</span><span style="color:#86E1FC"> -></span><span style="color:#FF966C"> dict</span><span style="color:#B4C2F0">:</span></span>
<span data-line=""><span style="color:#C8D3F5">    messages </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> [</span></span>
<span data-line=""><span style="color:#858AA6">        # role 옵션: "system" (시스템 프롬프트), "user" (사용자 입력), "assistant" (LLM 응답)</span></span>
<span data-line=""><span style="color:#86E1FC">        {</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">role</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">system</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">content</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#C8D3F5"> SYSTEM_PROMPT</span><span style="color:#86E1FC">}</span><span style="color:#858AA6">  # 시스템 프롬프트: LLM의 역할과 동작 방식 정의</span></span>
<span data-line=""><span style="color:#86E1FC">    ]</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">    # 대화 기록 추가</span></span>
<span data-line=""><span style="color:#C8D3F5">    messages</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">extend</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">conversation_history</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#C8D3F5">    messages</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">append</span><span style="color:#86E1FC">({</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">role</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">user</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">content</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#C8D3F5"> user_input</span><span style="color:#86E1FC">})</span><span style="color:#858AA6">  # 사용자 입력 추가</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C8D3F5">    payload </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">        "</span><span style="color:#C3E88D">model</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#C8D3F5"> MODEL</span><span style="color:#86E1FC">,</span></span>
<span data-line=""><span style="color:#86E1FC">        "</span><span style="color:#C3E88D">messages</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#C8D3F5"> messages</span><span style="color:#86E1FC">,</span></span>
<span data-line=""><span style="color:#86E1FC">        "</span><span style="color:#C3E88D">stream</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#FF98A4"> False</span><span style="color:#86E1FC">,</span><span style="color:#858AA6">      # False: 전체 응답을 한 번에 받음, True: 실시간 스트리밍</span></span>
<span data-line=""><span style="color:#86E1FC">        "</span><span style="color:#C3E88D">format</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">json</span><span style="color:#86E1FC">"</span><span style="color:#858AA6">      # JSON 형식으로 응답 받기 (파싱 용이)</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C8D3F5">    response </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> requests</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">post</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">OLLAMA_URL</span><span style="color:#86E1FC">,</span><span style="color:#FCA7EA"> json</span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5">payload</span><span style="color:#86E1FC">,</span><span style="color:#FCA7EA"> timeout</span><span style="color:#86E1FC">=</span><span style="color:#FF966C">30</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#C8D3F5">    result </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> json</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">loads</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">response</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">json</span><span style="color:#86E1FC">()[</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">message</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">][</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">content</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">])</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">    # 대화 기록 업데이트</span></span>
<span data-line=""><span style="color:#C8D3F5">    conversation_history</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">append</span><span style="color:#86E1FC">({</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">role</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">user</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">content</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#C8D3F5"> user_input</span><span style="color:#86E1FC">})</span><span style="color:#858AA6">  # 사용자 입력 저장</span></span>
<span data-line=""><span style="color:#C8D3F5">    conversation_history</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">append</span><span style="color:#86E1FC">({</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">role</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">assistant</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">content</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#C8D3F5"> result</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">get</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">reply</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> ""</span><span style="color:#86E1FC">)})</span><span style="color:#858AA6">  # LLM 응답 저장</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">    # 최대 20개 대화만 유지</span></span>
<span data-line=""><span style="color:#86E1FC">    if</span><span style="color:#65BCFF"> len</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">conversation_history</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> ></span><span style="color:#FF966C"> 20</span><span style="color:#86E1FC">:</span></span>
<span data-line=""><span style="color:#C8D3F5">        conversation_history </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> conversation_history</span><span style="color:#86E1FC">[-</span><span style="color:#FF966C">20</span><span style="color:#86E1FC">:]</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">    return</span><span style="color:#C8D3F5"> result</span></span><button type="button" title="Copy code" aria-label="Copy code" data="conversation_history = []

def call_ollama_with_history(user_input: str) -> dict:
    messages = [
        # role 옵션: &#x22;system&#x22; (시스템 프롬프트), &#x22;user&#x22; (사용자 입력), &#x22;assistant&#x22; (LLM 응답)
        {&#x22;role&#x22;: &#x22;system&#x22;, &#x22;content&#x22;: SYSTEM_PROMPT}  # 시스템 프롬프트: LLM의 역할과 동작 방식 정의
    ]

    # 대화 기록 추가
    messages.extend(conversation_history)
    messages.append({&#x22;role&#x22;: &#x22;user&#x22;, &#x22;content&#x22;: user_input})  # 사용자 입력 추가

    payload = {
        &#x22;model&#x22;: MODEL,
        &#x22;messages&#x22;: messages,
        &#x22;stream&#x22;: False,      # False: 전체 응답을 한 번에 받음, True: 실시간 스트리밍
        &#x22;format&#x22;: &#x22;json&#x22;      # JSON 형식으로 응답 받기 (파싱 용이)
    }

    response = requests.post(OLLAMA_URL, json=payload, timeout=30)
    result = json.loads(response.json()[&#x22;message&#x22;][&#x22;content&#x22;])

    # 대화 기록 업데이트
    conversation_history.append({&#x22;role&#x22;: &#x22;user&#x22;, &#x22;content&#x22;: user_input})  # 사용자 입력 저장
    conversation_history.append({&#x22;role&#x22;: &#x22;assistant&#x22;, &#x22;content&#x22;: result.get(&#x22;reply&#x22;, &#x22;&#x22;)})  # LLM 응답 저장

    # 최대 20개 대화만 유지
    if len(conversation_history) > 20:
        conversation_history = conversation_history[-20:]

    return result" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<h3 id="에러-처리"><a class="heading-link" aria-hidden="true" href="#에러-처리">에러 처리</a></h3>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="python" data-theme="moonlight-ii"><code data-language="python" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#C099FF">def</span><span style="color:#82AAFF"> safe_call_ollama</span><span style="color:#B4C2F0">(</span><span style="color:#FCA7EA">user_input</span><span style="color:#86E1FC">:</span><span style="color:#FF966C"> str</span><span style="color:#B4C2F0">)</span><span style="color:#86E1FC"> -></span><span style="color:#FF966C"> dict</span><span style="color:#B4C2F0">:</span></span>
<span data-line=""><span style="color:#86E1FC">    try:</span></span>
<span data-line=""><span style="color:#86E1FC">        return</span><span style="color:#C8D3F5"> call_ollama</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">user_input</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#86E1FC">    except</span><span style="color:#C8D3F5"> requests</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">exceptions</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">RequestException </span><span style="color:#86E1FC">as</span><span style="color:#C8D3F5"> e</span><span style="color:#86E1FC">:</span></span>
<span data-line=""><span style="color:#65BCFF">        print</span><span style="color:#86E1FC">(</span><span style="color:#C099FF">f</span><span style="color:#C3E88D">"Ollama 연결 오류: </span><span style="color:#FF98A4">{</span><span style="color:#C8D3F5">e</span><span style="color:#FF98A4">}</span><span style="color:#C3E88D">"</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#86E1FC">        return</span><span style="color:#86E1FC"> {</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">command</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> ""</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">reply</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">연결 오류가 발생했습니다.</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">}</span></span>
<span data-line=""><span style="color:#86E1FC">    except</span><span style="color:#C8D3F5"> json</span><span style="color:#86E1FC">.</span><span style="color:#C8D3F5">JSONDecodeError</span><span style="color:#86E1FC">:</span></span>
<span data-line=""><span style="color:#65BCFF">        print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">JSON 파싱 오류</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#86E1FC">        return</span><span style="color:#86E1FC"> {</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">command</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> ""</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">reply</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">:</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">응답을 처리할 수 없습니다.</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="def safe_call_ollama(user_input: str) -> dict:
    try:
        return call_ollama(user_input)
    except requests.exceptions.RequestException as e:
        print(f&#x22;Ollama 연결 오류: {e}&#x22;)
        return {&#x22;command&#x22;: &#x22;&#x22;, &#x22;reply&#x22;: &#x22;연결 오류가 발생했습니다.&#x22;}
    except json.JSONDecodeError:
        print(&#x22;JSON 파싱 오류&#x22;)
        return {&#x22;command&#x22;: &#x22;&#x22;, &#x22;reply&#x22;: &#x22;응답을 처리할 수 없습니다.&#x22;}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<h2 id="주의사항"><a class="heading-link" aria-hidden="true" href="#주의사항">주의사항</a></h2>
<ol>
<li><strong>시리얼 포트 확인</strong>: 시스템에 따라 시리얼 포트 경로가 다를 수 있다
<ul>
<li>Linux/Mac: <code>/dev/ttyACM0</code>, <code>/dev/ttyUSB0</code></li>
<li>Windows: <code>COM3</code>, <code>COM4</code> 등</li>
</ul>
</li>
<li><strong>보드레이트 일치</strong>: Python과 Arduino의 보드레이트가 일치해야 한다</li>
<li><strong>타임아웃 설정</strong>: 시리얼 통신 타임아웃을 적절히 설정</li>
<li><strong>명령 형식</strong>: LLM이 생성하는 명령 형식을 일관되게 유지</li>
</ol>
<h2 id="활용-예시"><a class="heading-link" aria-hidden="true" href="#활용-예시">활용 예시</a></h2>
<ul>
<li><strong>음성 인식 연동</strong>: 음성을 텍스트로 변환 후 LLM 분석</li>
<li><strong>센서 데이터 기반 제어</strong>: 센서 값을 LLM에 전달하여 상황에 맞는 제어</li>
<li><strong>자연어 명령</strong>: "조금 더 밝게", "천천히 움직여" 등 자연어 명령 처리</li>
</ul>
<h2 id="참고-자료"><a class="heading-link" aria-hidden="true" href="#참고-자료">참고 자료</a></h2>
<ul>
<li><a href="https://ollama.ai">Ollama 공식 문서</a></li>
<li><a href="https://pyserial.readthedocs.io/">PySerial 문서</a></li>
<li><a href="https://www.arduino.cc/reference/en/language/functions/communication/serial/">Arduino 시리얼 통신</a></li>
</ul>8:["$","$L4","Arduino/arduino-llm",{"post":{"metadata":{"title":"Arduino를 LLM으로 제어하기","summary":"Ollama를 사용한 로컬 LLM과 Python을 통해 아두이노를 제어하는 방법을 설명한다. 시리얼 통신을 활용한 LLM-아두이노 연동 기법을 정리한다.","locale":"ko","createdAt":"2026-01-08T16:39:51.000Z","updatedAt":"2026-01-08T16:39:51.000Z"},"slug":"Arduino/arduino-llm","source":"$10","type":"markdown","parentFolder":"Arduino"},"locale":"ko","delay":0.23000000000000004}]
11:T19382,<h2 id="라이브러리-설치"><a class="heading-link" aria-hidden="true" href="#라이브러리-설치">라이브러리 설치</a></h2>
<p>RFID 리더기 사용을 위해 MFRC522 라이브러리가 필요하다.</p>
<pre><code>Arduino IDE > 스케치 > 라이브러리 포함하기 > 라이브러리 관리
> "MFRC522" 검색 > 설치
</code></pre>
<h2 id="연결-방법"><a class="heading-link" aria-hidden="true" href="#연결-방법">연결 방법</a></h2>
<p>MFRC522 모듈과 아두이노 연결:</p>
<table>
<thead>
<tr>
<th>MFRC522</th>
<th>Arduino</th>
</tr>
</thead>
<tbody>
<tr>
<td>SDA</td>
<td>10</td>
</tr>
<tr>
<td>SCK</td>
<td>13</td>
</tr>
<tr>
<td>MOSI</td>
<td>11</td>
</tr>
<tr>
<td>MISO</td>
<td>12</td>
</tr>
<tr>
<td>RST</td>
<td>9</td>
</tr>
<tr>
<td>3.3V</td>
<td>3.3V (안될시 Vin)</td>
</tr>
<tr>
<td>GND</td>
<td>GND</td>
</tr>
</tbody>
</table>
<h2 id="주요-함수"><a class="heading-link" aria-hidden="true" href="#주요-함수">주요 함수</a></h2>
<ul>
<li>
<p><strong><code>mfrc522.PCD_Init()</code></strong>: MFRC522 RFID 리더기를 초기화하는 함수이다. PCD는 Proximity Coupling Device(근접 결합 장치)의 약자로, RFID 리더기 모듈을 사용하기 전에 반드시 호출해야 한다. 이 함수는 하드웨어를 초기화하고 기본 설정을 구성한다.</p>
</li>
<li>
<p><strong><code>mfrc522.PICC_IsNewCardPresent()</code></strong>: 리더기 근처에 새로운 카드가 있는지 확인하는 함수이다. PICC는 Proximity Integrated Circuit Card(근접 통합 회로 카드)의 약자이다. 카드가 감지되면 <code>true</code>, 없으면 <code>false</code>를 반환한다. <code>loop()</code> 함수에서 주기적으로 호출하여 카드 감지 여부를 확인한다.</p>
</li>
<li>
<p><strong><code>mfrc522.PICC_ReadCardSerial()</code></strong>: 카드의 시리얼 번호(UID)를 읽는 함수이다. 카드가 감지된 후 호출하여 <code>mfrc522.uid</code> 구조체에 UID 정보를 저장한다. 성공하면 <code>true</code>, 실패하면 <code>false</code>를 반환한다. 일반적으로 <code>PICC_IsNewCardPresent()</code> 다음에 호출한다.</p>
</li>
<li>
<p><strong><code>mfrc522.PICC_HaltA()</code></strong>: 현재 인식된 카드를 정지(Halt)시키는 함수이다. 카드와의 통신을 종료하고 카드를 대기 상태로 만든다. 카드 작업이 끝난 후 호출하여 다음 카드 감지를 준비한다. 이 함수를 호출하지 않으면 같은 카드가 계속 감지될 수 있다.</p>
</li>
<li>
<p><strong><code>mfrc522.PCD_StopCrypto1()</code></strong>: 암호화 통신을 종료하는 함수이다. 카드와의 인증된 통신이 끝난 후 호출하여 보안 상태를 해제한다. <code>PICC_HaltA()</code> 다음에 호출하는 것이 일반적이다.</p>
</li>
</ul>
<h2 id="mifare-classic-카드-구조"><a class="heading-link" aria-hidden="true" href="#mifare-classic-카드-구조">MIFARE Classic 카드 구조</a></h2>
<p>MIFARE Classic 카드는 <strong>16개의 섹터</strong>로 구성되어 있으며, 각 섹터는 <strong>4개의 블록</strong>으로 이루어져 있다.</p>
<ul>
<li><strong>총 블록 수</strong>: 64개 (0~63)</li>
<li><strong>섹터 수</strong>: 16개 (0~15)</li>
<li><strong>각 섹터의 블록 수</strong>: 4개</li>
<li><strong>블록 크기</strong>: 16바이트</li>
</ul>
<table>
<thead>
<tr>
<th>섹터</th>
<th>블록 번호</th>
<th>용도</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0~3</td>
<td>블록 0: 제조사 정보 (읽기 전용)</td>
</tr>
<tr>
<td>1</td>
<td>4~7</td>
<td>블록 7: 섹터 트레일러 (키 저장)</td>
</tr>
<tr>
<td>2</td>
<td>8~11</td>
<td>블록 11: 섹터 트레일러</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>15</td>
<td>60~63</td>
<td>블록 63: 섹터 트레일러</td>
</tr>
</tbody>
</table>
<p>각 섹터의 **마지막 블록(3, 7, 11, ..., 63)**은 <strong>섹터 트레일러</strong>로, 키와 접근 권한이 저장된다.</p>
<p>섹터 트레일러 구조 (16바이트) 는 다음과 같은 구조로 되어있다</p>
<pre><code>[키 A (6바이트)] [접근 비트 (4바이트)] [키 B (6바이트)]
</code></pre>
<ul>
<li><strong>키 A</strong>: 0~5번째 바이트</li>
<li><strong>접근 비트</strong>: 6~9번째 바이트</li>
<li><strong>키 B</strong>: 10~15번째 바이트</li>
</ul>
<h3 id="키-a와-키-b"><a class="heading-link" aria-hidden="true" href="#키-a와-키-b">키 A와 키 B</a></h3>
<p>섹터 트레일러에는 두 개의 인증 키가 저장되어 있다. 각 키는 6바이트(48비트)로 구성된다.</p>
<h4 id="키-a-key-a"><a class="heading-link" aria-hidden="true" href="#키-a-key-a">키 A (Key A)</a></h4>
<ul>
<li><strong>용도</strong>: 기본 인증 키로 가장 많이 사용된다</li>
<li><strong>인증 방법</strong>: <code>PICC_CMD_MF_AUTH_KEY_A</code> 사용</li>
<li><strong>기본값</strong>: <code>0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF</code> (6바이트)</li>
<li><strong>특징</strong>:
<ul>
<li>일반적으로 읽기/쓰기 인증에 사용</li>
<li>대부분의 경우 키 A만으로 충분</li>
<li>코드에서 <code>authenticateSector()</code> 함수가 키 A로 인증</li>
</ul>
</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#858AA6">// 키 A로 인증하는 예시</span></span>
<span data-line=""><span style="color:#FFC777">MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#C8D3F5">StatusCode status </span><span style="color:#86E1FC">=</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">PCD_Authenticate</span><span style="color:#86E1FC">(</span></span>
<span data-line=""><span style="color:#FFC777">  MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#C8D3F5">PICC_CMD_MF_AUTH_KEY_A</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> trailerBlock</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> &#x26;</span><span style="color:#C8D3F5">key</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> &#x26;(</span><span style="color:#FFC777">mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uid</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#86E1FC">);</span></span><button type="button" title="Copy code" aria-label="Copy code" data="// 키 A로 인증하는 예시
MFRC522::StatusCode status = mfrc522.PCD_Authenticate(
  MFRC522::PICC_CMD_MF_AUTH_KEY_A, trailerBlock, &#x26;key, &#x26;(mfrc522.uid)
);" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<h4 id="키-b-key-b"><a class="heading-link" aria-hidden="true" href="#키-b-key-b">키 B (Key B)</a></h4>
<ul>
<li><strong>용도</strong>: 추가 보안용 키 또는 특수 기능용 키</li>
<li><strong>인증 방법</strong>: <code>PICC_CMD_MF_AUTH_KEY_B</code> 사용</li>
<li><strong>기본값</strong>: <code>0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF</code> (6바이트)</li>
<li><strong>특징</strong>:
<ul>
<li>접근 비트(Access Bits) 설정에 따라 사용 여부가 결정됨</li>
<li>더 높은 보안이 필요한 경우 사용</li>
<li>값 증가/감소 같은 특수 기능에 사용 가능</li>
<li>접근 비트 설정에 따라 키 B가 읽기 전용이 되거나 사용 불가능할 수 있음</li>
</ul>
</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#858AA6">// 키 B로 인증하는 예시</span></span>
<span data-line=""><span style="color:#FFC777">MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#C8D3F5">StatusCode status </span><span style="color:#86E1FC">=</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">PCD_Authenticate</span><span style="color:#86E1FC">(</span></span>
<span data-line=""><span style="color:#FFC777">  MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#C8D3F5">PICC_CMD_MF_AUTH_KEY_B</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> trailerBlock</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> &#x26;</span><span style="color:#C8D3F5">key</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> &#x26;(</span><span style="color:#FFC777">mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uid</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#86E1FC">);</span></span><button type="button" title="Copy code" aria-label="Copy code" data="// 키 B로 인증하는 예시
MFRC522::StatusCode status = mfrc522.PCD_Authenticate(
  MFRC522::PICC_CMD_MF_AUTH_KEY_B, trailerBlock, &#x26;key, &#x26;(mfrc522.uid)
);" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<h4 id="키-a와-키-b의-차이"><a class="heading-link" aria-hidden="true" href="#키-a와-키-b의-차이">키 A와 키 B의 차이</a></h4>
<ol>
<li><strong>기본값</strong>: 둘 다 <code>0xFF</code> 6개로 동일하지만, 실제로는 서로 다른 키 값으로 설정 가능</li>
<li><strong>용도</strong>: 키 A는 기본 인증, 키 B는 추가 보안/특수 기능</li>
<li><strong>접근 권한</strong>: 접근 비트 설정에 따라 키 A만 사용하거나 키 B도 함께 사용 가능</li>
<li><strong>실제 사용</strong>: 대부분의 경우 키 A만 사용하며, 키 B는 고급 보안이 필요한 경우에 사용</li>
</ol>
<h4 id="기본-키-설정"><a class="heading-link" aria-hidden="true" href="#기본-키-설정">기본 키 설정</a></h4>
<p>대부분의 MIFARE Classic 카드는 다음 기본 키를 사용한다:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#C8D3F5">byte </span><span style="color:#FFC777">defaultKeyA</span><span style="color:#86E1FC">[</span><span style="color:#FF966C">6</span><span style="color:#86E1FC">]</span><span style="color:#86E1FC"> =</span><span style="color:#86E1FC"> {</span><span style="color:#FC7B7B">0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">,</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">,</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">,</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">,</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">,</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">};</span></span>
<span data-line=""><span style="color:#C8D3F5">byte </span><span style="color:#FFC777">defaultKeyB</span><span style="color:#86E1FC">[</span><span style="color:#FF966C">6</span><span style="color:#86E1FC">]</span><span style="color:#86E1FC"> =</span><span style="color:#86E1FC"> {</span><span style="color:#FC7B7B">0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">,</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">,</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">,</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">,</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">,</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">};</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 키 초기화</span></span>
<span data-line=""><span style="color:#FFC777">MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#C8D3F5">MIFARE_Key key</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">for</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">byte i </span><span style="color:#86E1FC">=</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">&#x3C;</span><span style="color:#FF966C"> 6</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i</span><span style="color:#86E1FC">++)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">  key</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">keyByte</span><span style="color:#86E1FC">[</span><span style="color:#B4C2F0">i</span><span style="color:#86E1FC">]</span><span style="color:#86E1FC"> =</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">;</span><span style="color:#858AA6">  // 키 A와 키 B 모두 기본값으로 설정</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="byte defaultKeyA[6] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};
byte defaultKeyB[6] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};

// 키 초기화
MFRC522::MIFARE_Key key;
for (byte i = 0; i < 6; i++) {
  key.keyByte[i] = 0xFF;  // 키 A와 키 B 모두 기본값으로 설정
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<p><strong>주의</strong>: 기본 키는 보안이 약하므로, 실제 프로덕션 환경에서는 고유한 키로 변경하는 것이 좋다.</p>
<h2 id="주의사항"><a class="heading-link" aria-hidden="true" href="#주의사항">주의사항</a></h2>
<ol>
<li><strong>블록 0은 읽기 전용</strong>: 제조사 정보가 저장되어 있어 수정할 수 없다.</li>
<li><strong>섹터 트레일러 수정 주의</strong>: 키나 접근 비트를 잘못 수정하면 카드를 사용할 수 없게 된다.</li>
<li><strong>인증 필요</strong>: 데이터를 읽거나 쓰기 전에 반드시 인증이 필요하다.</li>
<li><strong>키 관리</strong>: 기본 키 외에 다른 키를 사용하는 경우, 해당 키를 알고 있어야 데이터에 접근할 수 있다.</li>
<li><strong>블록 선택</strong>: 데이터 저장 시 블록 0과 섹터 트레일러는 반드시 피해야 한다.</li>
</ol>
<h2 id="라이브러리"><a class="heading-link" aria-hidden="true" href="#라이브러리">라이브러리</a></h2>
<ul>
<li>RFIDCard.h</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#86E1FC">#ifndef</span><span style="color:#82AAFF"> RFID_CARD_H</span></span>
<span data-line=""><span style="color:#86E1FC">#define</span><span style="color:#82AAFF"> RFID_CARD_H</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">#include</span><span style="color:#86E1FC"> &#x3C;</span><span style="color:#C3E88D">Arduino.h</span><span style="color:#86E1FC">></span></span>
<span data-line=""><span style="color:#86E1FC">#include</span><span style="color:#86E1FC"> &#x3C;</span><span style="color:#C3E88D">SPI.h</span><span style="color:#86E1FC">></span></span>
<span data-line=""><span style="color:#86E1FC">#include</span><span style="color:#86E1FC"> &#x3C;</span><span style="color:#C3E88D">MFRC522.h</span><span style="color:#86E1FC">></span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// UID 구조체 (리스트에 저장하기 위해)</span></span>
<span data-line=""><span style="color:#C099FF">struct</span><span style="color:#FFC777"> CardUID</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">  byte </span><span style="color:#FFC777">uidByte</span><span style="color:#86E1FC">[</span><span style="color:#FF966C">10</span><span style="color:#86E1FC">];</span><span style="color:#858AA6">  // 최대 10바이트 (일반적으로 4 또는 7바이트)</span></span>
<span data-line=""><span style="color:#B4C2F0">  byte size</span><span style="color:#86E1FC">;</span><span style="color:#858AA6">         // UID 크기</span></span>
<span data-line=""><span style="color:#86E1FC">};</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// RFID 카드 관리 함수들 (범용 함수)</span></span>
<span data-line=""><span style="color:#858AA6">// MFRC522 객체는 외부에서 전역으로 관리됨</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 초기화 (MFRC522 객체와 키 참조 전달)</span></span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> initRFIDCard</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#FFC777">MIFARE_Key</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> key</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 카드가 감지되었는지 확인</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#82AAFF"> isCardPresent</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 현재 카드의 UID를 CardUID 구조체로 변환</span></span>
<span data-line=""><span style="color:#FFC777">CardUID</span><span style="color:#82AAFF"> getCurrentCardUID</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 두 UID가 같은지 비교</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#82AAFF"> compareUIDs</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">CardUID</span><span style="color:#FCA7EA"> uid1</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> CardUID</span><span style="color:#FCA7EA"> uid2</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 카드 처리 종료</span></span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> haltCard</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// UID 출력 (디버깅용)</span></span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> printUID</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// ============================================</span></span>
<span data-line=""><span style="color:#858AA6">// 안전한 블록 체크 함수</span></span>
<span data-line=""><span style="color:#858AA6">// ============================================</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 안전한 블록인지 확인 (블록 0과 섹터 트레일러 제외)</span></span>
<span data-line=""><span style="color:#858AA6">// blockAddr: 확인할 블록 주소</span></span>
<span data-line=""><span style="color:#858AA6">// 반환값: 안전한 블록이면 true, 아니면 false</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#82AAFF"> isSafeBlock</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">byte</span><span style="color:#FCA7EA"> blockAddr</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 다음 안전한 블록 찾기</span></span>
<span data-line=""><span style="color:#858AA6">// startBlock: 검색을 시작할 블록 주소</span></span>
<span data-line=""><span style="color:#858AA6">// 반환값: 찾은 블록 주소, 없으면 255</span></span>
<span data-line=""><span style="color:#FFC777">byte</span><span style="color:#82AAFF"> findNextSafeBlock</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">byte</span><span style="color:#FCA7EA"> startBlock</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// ============================================</span></span>
<span data-line=""><span style="color:#858AA6">// 범용 블록 읽기/쓰기 함수 (템플릿)</span></span>
<span data-line=""><span style="color:#858AA6">// ============================================</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 섹터 트레일러 블록 주소 계산 (헬퍼 함수)</span></span>
<span data-line=""><span style="color:#FFC777">byte</span><span style="color:#82AAFF"> getTrailerBlock</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">byte</span><span style="color:#FCA7EA"> blockAddr</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 섹터 인증 (헬퍼 함수)</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#82AAFF"> authenticateSector</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#FFC777">MIFARE_Key</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> key</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> byte</span><span style="color:#FCA7EA"> blockAddr</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 구조체를 지정된 블록에 쓰기 (템플릿)</span></span>
<span data-line=""><span style="color:#858AA6">// T: 쓰고자 하는 구조체 타입</span></span>
<span data-line=""><span style="color:#858AA6">// blockAddr: 시작 블록 주소</span></span>
<span data-line=""><span style="color:#858AA6">// 반환값: 성공 시 true, 실패 시 false</span></span>
<span data-line=""><span style="color:#C099FF">template</span><span style="color:#86E1FC">&#x3C;</span><span style="color:#C099FF">typename</span><span style="color:#FFC777"> T</span><span style="color:#86E1FC">></span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#82AAFF"> writeToBlock</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#FFC777">MIFARE_Key</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> key</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> byte</span><span style="color:#FCA7EA"> blockAddr</span><span style="color:#86E1FC">,</span><span style="color:#C099FF"> const</span><span style="color:#FFC777"> T</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> data</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#C099FF">  size_t</span><span style="color:#C8D3F5"> dataSize </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> sizeof(</span><span style="color:#C8D3F5">T</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#C099FF">  size_t</span><span style="color:#C8D3F5"> numBlocks </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">dataSize </span><span style="color:#86E1FC">+</span><span style="color:#FF966C"> 15</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> /</span><span style="color:#FF966C"> 16</span><span style="color:#86E1FC">;</span><span style="color:#858AA6">  // 필요한 블록 수 계산 (올림)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">numBlocks </span><span style="color:#86E1FC">==</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">    Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">데이터 크기가 0입니다.</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">    return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 데이터를 바이트 배열로 변환</span></span>
<span data-line=""><span style="color:#C8D3F5">  byte</span><span style="color:#86E1FC">*</span><span style="color:#C8D3F5"> dataBytes </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">byte</span><span style="color:#86E1FC">*)&#x26;</span><span style="color:#C8D3F5">data</span><span style="color:#86E1FC">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 각 블록에 쓰기</span></span>
<span data-line=""><span style="color:#86E1FC">  for</span><span style="color:#86E1FC"> (</span><span style="color:#C099FF">size_t</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">=</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">&#x3C;</span><span style="color:#C8D3F5"> numBlocks</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i</span><span style="color:#86E1FC">++)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">    byte currentBlock </span><span style="color:#86E1FC">=</span><span style="color:#B4C2F0"> blockAddr </span><span style="color:#86E1FC">+</span><span style="color:#B4C2F0"> i</span><span style="color:#86E1FC">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">    // 섹터 인증 (각 블록이 속한 섹터마다)</span></span>
<span data-line=""><span style="color:#86E1FC">    if</span><span style="color:#86E1FC"> (!</span><span style="color:#82AAFF">authenticateSector</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> key</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> currentBlock</span><span style="color:#86E1FC">))</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">블록 </span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">currentBlock</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D"> 인증 실패</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">      return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">    // 현재 블록에 쓸 데이터 준비 (최대 16바이트)</span></span>
<span data-line=""><span style="color:#B4C2F0">    byte </span><span style="color:#FFC777">blockData</span><span style="color:#86E1FC">[</span><span style="color:#FF966C">16</span><span style="color:#86E1FC">];</span></span>
<span data-line=""><span style="color:#C099FF">    size_t</span><span style="color:#B4C2F0"> offset </span><span style="color:#86E1FC">=</span><span style="color:#B4C2F0"> i </span><span style="color:#86E1FC">*</span><span style="color:#FF966C"> 16</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#C099FF">    size_t</span><span style="color:#B4C2F0"> bytesToWrite </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> (</span><span style="color:#B4C2F0">offset </span><span style="color:#86E1FC">+</span><span style="color:#FF966C"> 16</span><span style="color:#86E1FC"> &#x3C;=</span><span style="color:#B4C2F0"> dataSize</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> ?</span><span style="color:#FF966C"> 16</span><span style="color:#86E1FC"> :</span><span style="color:#86E1FC"> (</span><span style="color:#B4C2F0">dataSize </span><span style="color:#86E1FC">-</span><span style="color:#B4C2F0"> offset</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#82AAFF">    memcpy</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">blockData</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> dataBytes </span><span style="color:#86E1FC">+</span><span style="color:#B4C2F0"> offset</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> bytesToWrite</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#858AA6">    // 나머지 바이트는 0으로 채우기</span></span>
<span data-line=""><span style="color:#86E1FC">    for</span><span style="color:#86E1FC"> (</span><span style="color:#C099FF">size_t</span><span style="color:#B4C2F0"> j </span><span style="color:#86E1FC">=</span><span style="color:#B4C2F0"> bytesToWrite</span><span style="color:#86E1FC">;</span><span style="color:#B4C2F0"> j </span><span style="color:#86E1FC">&#x3C;</span><span style="color:#FF966C"> 16</span><span style="color:#86E1FC">;</span><span style="color:#B4C2F0"> j</span><span style="color:#86E1FC">++)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">      blockData</span><span style="color:#86E1FC">[</span><span style="color:#B4C2F0">j</span><span style="color:#86E1FC">]</span><span style="color:#86E1FC"> =</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">    // 블록에 쓰기</span></span>
<span data-line=""><span style="color:#FFC777">    MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#B4C2F0">StatusCode status </span><span style="color:#86E1FC">=</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">MIFARE_Write</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">currentBlock</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> blockData</span><span style="color:#86E1FC">,</span><span style="color:#FF966C"> 16</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">    if</span><span style="color:#86E1FC"> (</span><span style="color:#B4C2F0">status </span><span style="color:#86E1FC">!=</span><span style="color:#FFC777"> MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#B4C2F0">STATUS_OK</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">블록 </span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">currentBlock</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D"> 쓰기 실패</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">      return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#FF98A4"> true</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 지정된 블록에서 구조체 읽기 (템플릿)</span></span>
<span data-line=""><span style="color:#858AA6">// T: 읽고자 하는 구조체 타입</span></span>
<span data-line=""><span style="color:#858AA6">// blockAddr: 시작 블록 주소</span></span>
<span data-line=""><span style="color:#858AA6">// 반환값: 성공 시 true, 실패 시 false</span></span>
<span data-line=""><span style="color:#C099FF">template</span><span style="color:#86E1FC">&#x3C;</span><span style="color:#C099FF">typename</span><span style="color:#FFC777"> T</span><span style="color:#86E1FC">></span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#82AAFF"> readFromBlock</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#FFC777">MIFARE_Key</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> key</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> byte</span><span style="color:#FCA7EA"> blockAddr</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> T</span><span style="color:#C099FF">*</span><span style="color:#FCA7EA"> data</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#C099FF">  size_t</span><span style="color:#C8D3F5"> dataSize </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> sizeof(</span><span style="color:#C8D3F5">T</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#C099FF">  size_t</span><span style="color:#C8D3F5"> numBlocks </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">dataSize </span><span style="color:#86E1FC">+</span><span style="color:#FF966C"> 15</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> /</span><span style="color:#FF966C"> 16</span><span style="color:#86E1FC">;</span><span style="color:#858AA6">  // 필요한 블록 수 계산 (올림)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">numBlocks </span><span style="color:#86E1FC">==</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">    Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">데이터 크기가 0입니다.</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">    return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 데이터를 저장할 바이트 배열</span></span>
<span data-line=""><span style="color:#C8D3F5">  byte</span><span style="color:#86E1FC">*</span><span style="color:#C8D3F5"> dataBytes </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">byte</span><span style="color:#86E1FC">*)</span><span style="color:#C8D3F5">data</span><span style="color:#86E1FC">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 각 블록에서 읽기</span></span>
<span data-line=""><span style="color:#86E1FC">  for</span><span style="color:#86E1FC"> (</span><span style="color:#C099FF">size_t</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">=</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">&#x3C;</span><span style="color:#C8D3F5"> numBlocks</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i</span><span style="color:#86E1FC">++)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">    byte currentBlock </span><span style="color:#86E1FC">=</span><span style="color:#B4C2F0"> blockAddr </span><span style="color:#86E1FC">+</span><span style="color:#B4C2F0"> i</span><span style="color:#86E1FC">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">    // 섹터 인증 (각 블록이 속한 섹터마다)</span></span>
<span data-line=""><span style="color:#86E1FC">    if</span><span style="color:#86E1FC"> (!</span><span style="color:#82AAFF">authenticateSector</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> key</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> currentBlock</span><span style="color:#86E1FC">))</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">블록 </span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">currentBlock</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D"> 인증 실패</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">      return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">    // 블록 읽기</span></span>
<span data-line=""><span style="color:#B4C2F0">    byte </span><span style="color:#FFC777">buffer</span><span style="color:#86E1FC">[</span><span style="color:#FF966C">18</span><span style="color:#86E1FC">];</span></span>
<span data-line=""><span style="color:#B4C2F0">    byte size </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> sizeof(</span><span style="color:#B4C2F0">buffer</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFC777">    MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#B4C2F0">StatusCode status </span><span style="color:#86E1FC">=</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">MIFARE_Read</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">currentBlock</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> buffer</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> &#x26;</span><span style="color:#B4C2F0">size</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">    if</span><span style="color:#86E1FC"> (</span><span style="color:#B4C2F0">status </span><span style="color:#86E1FC">!=</span><span style="color:#FFC777"> MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#B4C2F0">STATUS_OK</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">블록 </span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">currentBlock</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">      Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D"> 읽기 실패</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">      return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">    // 읽은 데이터 복사 (최대 16바이트)</span></span>
<span data-line=""><span style="color:#C099FF">    size_t</span><span style="color:#B4C2F0"> offset </span><span style="color:#86E1FC">=</span><span style="color:#B4C2F0"> i </span><span style="color:#86E1FC">*</span><span style="color:#FF966C"> 16</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#C099FF">    size_t</span><span style="color:#B4C2F0"> bytesToRead </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> (</span><span style="color:#B4C2F0">offset </span><span style="color:#86E1FC">+</span><span style="color:#FF966C"> 16</span><span style="color:#86E1FC"> &#x3C;=</span><span style="color:#B4C2F0"> dataSize</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> ?</span><span style="color:#FF966C"> 16</span><span style="color:#86E1FC"> :</span><span style="color:#86E1FC"> (</span><span style="color:#B4C2F0">dataSize </span><span style="color:#86E1FC">-</span><span style="color:#B4C2F0"> offset</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#82AAFF">    memcpy</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">dataBytes </span><span style="color:#86E1FC">+</span><span style="color:#B4C2F0"> offset</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> buffer</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> bytesToRead</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#FF98A4"> true</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">#endif</span></span><button type="button" title="Copy code" aria-label="Copy code" data="#ifndef RFID_CARD_H
#define RFID_CARD_H

#include <Arduino.h>
#include <SPI.h>
#include <MFRC522.h>

// UID 구조체 (리스트에 저장하기 위해)
struct CardUID {
  byte uidByte[10];  // 최대 10바이트 (일반적으로 4 또는 7바이트)
  byte size;         // UID 크기
};

// RFID 카드 관리 함수들 (범용 함수)
// MFRC522 객체는 외부에서 전역으로 관리됨

// 초기화 (MFRC522 객체와 키 참조 전달)
void initRFIDCard(MFRC522&#x26; mfrc522, MFRC522::MIFARE_Key&#x26; key);

// 카드가 감지되었는지 확인
bool isCardPresent(MFRC522&#x26; mfrc522);

// 현재 카드의 UID를 CardUID 구조체로 변환
CardUID getCurrentCardUID(MFRC522&#x26; mfrc522);

// 두 UID가 같은지 비교
bool compareUIDs(CardUID uid1, CardUID uid2);

// 카드 처리 종료
void haltCard(MFRC522&#x26; mfrc522);

// UID 출력 (디버깅용)
void printUID(MFRC522&#x26; mfrc522);

// ============================================
// 안전한 블록 체크 함수
// ============================================

// 안전한 블록인지 확인 (블록 0과 섹터 트레일러 제외)
// blockAddr: 확인할 블록 주소
// 반환값: 안전한 블록이면 true, 아니면 false
bool isSafeBlock(byte blockAddr);

// 다음 안전한 블록 찾기
// startBlock: 검색을 시작할 블록 주소
// 반환값: 찾은 블록 주소, 없으면 255
byte findNextSafeBlock(byte startBlock);

// ============================================
// 범용 블록 읽기/쓰기 함수 (템플릿)
// ============================================

// 섹터 트레일러 블록 주소 계산 (헬퍼 함수)
byte getTrailerBlock(byte blockAddr);

// 섹터 인증 (헬퍼 함수)
bool authenticateSector(MFRC522&#x26; mfrc522, MFRC522::MIFARE_Key&#x26; key, byte blockAddr);

// 구조체를 지정된 블록에 쓰기 (템플릿)
// T: 쓰고자 하는 구조체 타입
// blockAddr: 시작 블록 주소
// 반환값: 성공 시 true, 실패 시 false
template<typename T>
bool writeToBlock(MFRC522&#x26; mfrc522, MFRC522::MIFARE_Key&#x26; key, byte blockAddr, const T&#x26; data) {
  size_t dataSize = sizeof(T);
  size_t numBlocks = (dataSize + 15) / 16;  // 필요한 블록 수 계산 (올림)

  if (numBlocks == 0) {
    Serial.println(&#x22;데이터 크기가 0입니다.&#x22;);
    return false;
  }

  // 데이터를 바이트 배열로 변환
  byte* dataBytes = (byte*)&#x26;data;

  // 각 블록에 쓰기
  for (size_t i = 0; i < numBlocks; i++) {
    byte currentBlock = blockAddr + i;

    // 섹터 인증 (각 블록이 속한 섹터마다)
    if (!authenticateSector(mfrc522, key, currentBlock)) {
      Serial.print(&#x22;블록 &#x22;);
      Serial.print(currentBlock);
      Serial.println(&#x22; 인증 실패&#x22;);
      return false;
    }

    // 현재 블록에 쓸 데이터 준비 (최대 16바이트)
    byte blockData[16];
    size_t offset = i * 16;
    size_t bytesToWrite = (offset + 16 <= dataSize) ? 16 : (dataSize - offset);

    memcpy(blockData, dataBytes + offset, bytesToWrite);
    // 나머지 바이트는 0으로 채우기
    for (size_t j = bytesToWrite; j < 16; j++) {
      blockData[j] = 0;
    }

    // 블록에 쓰기
    MFRC522::StatusCode status = mfrc522.MIFARE_Write(currentBlock, blockData, 16);
    if (status != MFRC522::STATUS_OK) {
      Serial.print(&#x22;블록 &#x22;);
      Serial.print(currentBlock);
      Serial.println(&#x22; 쓰기 실패&#x22;);
      return false;
    }
  }

  return true;
}

// 지정된 블록에서 구조체 읽기 (템플릿)
// T: 읽고자 하는 구조체 타입
// blockAddr: 시작 블록 주소
// 반환값: 성공 시 true, 실패 시 false
template<typename T>
bool readFromBlock(MFRC522&#x26; mfrc522, MFRC522::MIFARE_Key&#x26; key, byte blockAddr, T* data) {
  size_t dataSize = sizeof(T);
  size_t numBlocks = (dataSize + 15) / 16;  // 필요한 블록 수 계산 (올림)

  if (numBlocks == 0) {
    Serial.println(&#x22;데이터 크기가 0입니다.&#x22;);
    return false;
  }

  // 데이터를 저장할 바이트 배열
  byte* dataBytes = (byte*)data;

  // 각 블록에서 읽기
  for (size_t i = 0; i < numBlocks; i++) {
    byte currentBlock = blockAddr + i;

    // 섹터 인증 (각 블록이 속한 섹터마다)
    if (!authenticateSector(mfrc522, key, currentBlock)) {
      Serial.print(&#x22;블록 &#x22;);
      Serial.print(currentBlock);
      Serial.println(&#x22; 인증 실패&#x22;);
      return false;
    }

    // 블록 읽기
    byte buffer[18];
    byte size = sizeof(buffer);

    MFRC522::StatusCode status = mfrc522.MIFARE_Read(currentBlock, buffer, &#x26;size);
    if (status != MFRC522::STATUS_OK) {
      Serial.print(&#x22;블록 &#x22;);
      Serial.print(currentBlock);
      Serial.println(&#x22; 읽기 실패&#x22;);
      return false;
    }

    // 읽은 데이터 복사 (최대 16바이트)
    size_t offset = i * 16;
    size_t bytesToRead = (offset + 16 <= dataSize) ? 16 : (dataSize - offset);
    memcpy(dataBytes + offset, buffer, bytesToRead);
  }

  return true;
}

#endif" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<ul>
<li>RFIDCard.cpp</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#86E1FC">#include</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">RFIDCard.h</span><span style="color:#86E1FC">"</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 초기화</span></span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> initRFIDCard</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#FFC777">MIFARE_Key</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> key</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">  SPI</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">begin</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#FFC777">  mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">PCD_Init</span><span style="color:#86E1FC">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 기본 키 설정 (0xFF로 초기화)</span></span>
<span data-line=""><span style="color:#86E1FC">  for</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">byte i </span><span style="color:#86E1FC">=</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">&#x3C;</span><span style="color:#FF966C"> 6</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i</span><span style="color:#86E1FC">++)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">    key</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">keyByte</span><span style="color:#86E1FC">[</span><span style="color:#B4C2F0">i</span><span style="color:#86E1FC">]</span><span style="color:#86E1FC"> =</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">FF</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 카드가 감지되었는지 확인</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#82AAFF"> isCardPresent</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">PICC_IsNewCardPresent</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> &#x26;&#x26;</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">PICC_ReadCardSerial</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 현재 카드의 UID를 CardUID 구조체로 변환</span></span>
<span data-line=""><span style="color:#FFC777">CardUID</span><span style="color:#82AAFF"> getCurrentCardUID</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#C8D3F5">  CardUID cardUID</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#FFC777">  cardUID</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">size</span><span style="color:#86E1FC"> =</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uid</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">size</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">  for</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">byte i </span><span style="color:#86E1FC">=</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">&#x3C;</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uid</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">size</span><span style="color:#86E1FC"> &#x26;&#x26;</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">&#x3C;</span><span style="color:#FF966C"> 10</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i</span><span style="color:#86E1FC">++)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">    cardUID</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uidByte</span><span style="color:#86E1FC">[</span><span style="color:#B4C2F0">i</span><span style="color:#86E1FC">]</span><span style="color:#86E1FC"> =</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uid</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uidByte</span><span style="color:#86E1FC">[</span><span style="color:#B4C2F0">i</span><span style="color:#86E1FC">];</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#C8D3F5"> cardUID</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 두 UID가 같은지 비교</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#82AAFF"> compareUIDs</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">CardUID</span><span style="color:#FCA7EA"> uid1</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> CardUID</span><span style="color:#FCA7EA"> uid2</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> (</span><span style="color:#FFC777">uid1</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">size</span><span style="color:#86E1FC"> !=</span><span style="color:#FFC777"> uid2</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">size</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">    return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""><span style="color:#86E1FC">  for</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">byte i </span><span style="color:#86E1FC">=</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">&#x3C;</span><span style="color:#FFC777"> uid1</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">size</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i</span><span style="color:#86E1FC">++)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">    if</span><span style="color:#86E1FC"> (</span><span style="color:#FFC777">uid1</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uidByte</span><span style="color:#86E1FC">[</span><span style="color:#B4C2F0">i</span><span style="color:#86E1FC">]</span><span style="color:#86E1FC"> !=</span><span style="color:#FFC777"> uid2</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uidByte</span><span style="color:#86E1FC">[</span><span style="color:#B4C2F0">i</span><span style="color:#86E1FC">])</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">      return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#FF98A4"> true</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 카드 처리 종료</span></span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> haltCard</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">  mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">PICC_HaltA</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#FFC777">  mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">PCD_StopCrypto1</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// UID 출력 (디버깅용)</span></span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> printUID</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">UID: </span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">  for</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">byte i </span><span style="color:#86E1FC">=</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">&#x3C;</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uid</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">size</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i</span><span style="color:#86E1FC">++)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">    Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uid</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uidByte</span><span style="color:#86E1FC">[</span><span style="color:#B4C2F0">i</span><span style="color:#86E1FC">]</span><span style="color:#86E1FC"> &#x3C;</span><span style="color:#FC7B7B"> 0x</span><span style="color:#FF966C">10</span><span style="color:#86E1FC"> ?</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D"> 0</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC"> :</span><span style="color:#86E1FC"> "</span><span style="color:#86E1FC"> "</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">    Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uid</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uidByte</span><span style="color:#86E1FC">[</span><span style="color:#B4C2F0">i</span><span style="color:#86E1FC">],</span><span style="color:#B4C2F0"> HEX</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">();</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 안전한 블록인지 확인 (블록 0과 섹터 트레일러 제외)</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#82AAFF"> isSafeBlock</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">byte</span><span style="color:#FCA7EA"> blockAddr</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#858AA6">  // 블록 0은 제조사 정보 (읽기 전용)</span></span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">blockAddr </span><span style="color:#86E1FC">==</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 섹터 트레일러는 각 섹터의 마지막 블록 (3, 7, 11, ..., 63)</span></span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> ((</span><span style="color:#C8D3F5">blockAddr </span><span style="color:#86E1FC">+</span><span style="color:#FF966C"> 1</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> %</span><span style="color:#FF966C"> 4</span><span style="color:#86E1FC"> ==</span><span style="color:#FF966C"> 0</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> return</span><span style="color:#FF98A4"> false</span><span style="color:#86E1FC">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#FF98A4"> true</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 다음 안전한 블록 찾기</span></span>
<span data-line=""><span style="color:#FFC777">byte</span><span style="color:#82AAFF"> findNextSafeBlock</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">byte</span><span style="color:#FCA7EA"> startBlock</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">  for</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">byte i </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> startBlock</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i </span><span style="color:#86E1FC">&#x3C;</span><span style="color:#FF966C"> 64</span><span style="color:#86E1FC">;</span><span style="color:#C8D3F5"> i</span><span style="color:#86E1FC">++)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">    if</span><span style="color:#86E1FC"> (</span><span style="color:#82AAFF">isSafeBlock</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">i</span><span style="color:#86E1FC">))</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">      return</span><span style="color:#B4C2F0"> i</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#86E1FC">    }</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#FF966C"> 255</span><span style="color:#86E1FC">;</span><span style="color:#858AA6"> // 사용 가능한 블록 없음</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 섹터 트레일러 블록 주소 계산</span></span>
<span data-line=""><span style="color:#FFC777">byte</span><span style="color:#82AAFF"> getTrailerBlock</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">byte</span><span style="color:#FCA7EA"> blockAddr</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#858AA6">  // MIFARE 카드는 16개 섹터로 구성되며, 각 섹터는 4개 블록으로 구성됩니다</span></span>
<span data-line=""><span style="color:#858AA6">  // 예: 섹터 0 = 블록 0,1,2,3 / 섹터 1 = 블록 4,5,6,7 / 섹터 2 = 블록 8,9,10,11</span></span>
<span data-line=""><span style="color:#858AA6">  // 각 섹터의 마지막 블록(인덱스 3, 7, 11, ...)은 트레일러 블록으로,</span></span>
<span data-line=""><span style="color:#858AA6">  // 인증 키와 접근 권한이 저장되어 있어 데이터 블록에 접근하기 전에 인증이 필요합니다</span></span>
<span data-line=""><span style="color:#C8D3F5">  byte sector </span><span style="color:#86E1FC">=</span><span style="color:#C8D3F5"> blockAddr </span><span style="color:#86E1FC">/</span><span style="color:#FF966C"> 4</span><span style="color:#86E1FC">;</span><span style="color:#858AA6">              // 블록 주소를 4로 나누면 섹터 번호를 얻을 수 있음</span></span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">sector </span><span style="color:#86E1FC">*</span><span style="color:#FF966C"> 4</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> +</span><span style="color:#FF966C"> 3</span><span style="color:#86E1FC">;</span><span style="color:#858AA6">                   // 섹터 번호 * 4 + 3 = 해당 섹터의 트레일러 블록 주소</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 섹터 인증</span></span>
<span data-line=""><span style="color:#C099FF">bool</span><span style="color:#82AAFF"> authenticateSector</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">MFRC522</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#FFC777">MIFARE_Key</span><span style="color:#C099FF">&#x26;</span><span style="color:#FCA7EA"> key</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> byte</span><span style="color:#FCA7EA"> blockAddr</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#C8D3F5">  byte trailerBlock </span><span style="color:#86E1FC">=</span><span style="color:#82AAFF"> getTrailerBlock</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">blockAddr</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFC777">  MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#C8D3F5">StatusCode status </span><span style="color:#86E1FC">=</span><span style="color:#FFC777"> mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">PCD_Authenticate</span><span style="color:#86E1FC">(</span></span>
<span data-line=""><span style="color:#FFC777">    MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#C8D3F5">PICC_CMD_MF_AUTH_KEY_A</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> trailerBlock</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> &#x26;</span><span style="color:#C8D3F5">key</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> &#x26;(</span><span style="color:#FFC777">mfrc522</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">uid</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#86E1FC">  );</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#86E1FC">  return</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">status </span><span style="color:#86E1FC">==</span><span style="color:#FFC777"> MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#C8D3F5">STATUS_OK</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="#include &#x22;RFIDCard.h&#x22;

// 초기화
void initRFIDCard(MFRC522&#x26; mfrc522, MFRC522::MIFARE_Key&#x26; key) {
  SPI.begin();
  mfrc522.PCD_Init();

  // 기본 키 설정 (0xFF로 초기화)
  for (byte i = 0; i < 6; i++) {
    key.keyByte[i] = 0xFF;
  }
}

// 카드가 감지되었는지 확인
bool isCardPresent(MFRC522&#x26; mfrc522) {
  return mfrc522.PICC_IsNewCardPresent() &#x26;&#x26; mfrc522.PICC_ReadCardSerial();
}

// 현재 카드의 UID를 CardUID 구조체로 변환
CardUID getCurrentCardUID(MFRC522&#x26; mfrc522) {
  CardUID cardUID;
  cardUID.size = mfrc522.uid.size;
  for (byte i = 0; i < mfrc522.uid.size &#x26;&#x26; i < 10; i++) {
    cardUID.uidByte[i] = mfrc522.uid.uidByte[i];
  }
  return cardUID;
}

// 두 UID가 같은지 비교
bool compareUIDs(CardUID uid1, CardUID uid2) {
  if (uid1.size != uid2.size) {
    return false;
  }
  for (byte i = 0; i < uid1.size; i++) {
    if (uid1.uidByte[i] != uid2.uidByte[i]) {
      return false;
    }
  }
  return true;
}


// 카드 처리 종료
void haltCard(MFRC522&#x26; mfrc522) {
  mfrc522.PICC_HaltA();
  mfrc522.PCD_StopCrypto1();
}

// UID 출력 (디버깅용)
void printUID(MFRC522&#x26; mfrc522) {
  Serial.print(&#x22;UID: &#x22;);
  for (byte i = 0; i < mfrc522.uid.size; i++) {
    Serial.print(mfrc522.uid.uidByte[i] < 0x10 ? &#x22; 0&#x22; : &#x22; &#x22;);
    Serial.print(mfrc522.uid.uidByte[i], HEX);
  }
  Serial.println();
}

// 안전한 블록인지 확인 (블록 0과 섹터 트레일러 제외)
bool isSafeBlock(byte blockAddr) {
  // 블록 0은 제조사 정보 (읽기 전용)
  if (blockAddr == 0) return false;

  // 섹터 트레일러는 각 섹터의 마지막 블록 (3, 7, 11, ..., 63)
  if ((blockAddr + 1) % 4 == 0) return false;

  return true;
}

// 다음 안전한 블록 찾기
byte findNextSafeBlock(byte startBlock) {
  for (byte i = startBlock; i < 64; i++) {
    if (isSafeBlock(i)) {
      return i;
    }
  }
  return 255; // 사용 가능한 블록 없음
}

// 섹터 트레일러 블록 주소 계산
byte getTrailerBlock(byte blockAddr) {
  // MIFARE 카드는 16개 섹터로 구성되며, 각 섹터는 4개 블록으로 구성됩니다
  // 예: 섹터 0 = 블록 0,1,2,3 / 섹터 1 = 블록 4,5,6,7 / 섹터 2 = 블록 8,9,10,11
  // 각 섹터의 마지막 블록(인덱스 3, 7, 11, ...)은 트레일러 블록으로,
  // 인증 키와 접근 권한이 저장되어 있어 데이터 블록에 접근하기 전에 인증이 필요합니다
  byte sector = blockAddr / 4;              // 블록 주소를 4로 나누면 섹터 번호를 얻을 수 있음
  return (sector * 4) + 3;                   // 섹터 번호 * 4 + 3 = 해당 섹터의 트레일러 블록 주소
}

// 섹터 인증
bool authenticateSector(MFRC522&#x26; mfrc522, MFRC522::MIFARE_Key&#x26; key, byte blockAddr) {
  byte trailerBlock = getTrailerBlock(blockAddr);

  MFRC522::StatusCode status = mfrc522.PCD_Authenticate(
    MFRC522::PICC_CMD_MF_AUTH_KEY_A, trailerBlock, &#x26;key, &#x26;(mfrc522.uid)
  );

  return (status == MFRC522::STATUS_OK);
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<ul>
<li>사용법</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c++" data-theme="moonlight-ii"><code data-language="c++" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#86E1FC">#include</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">RFIDCard.h</span><span style="color:#86E1FC">"</span></span>
<span data-line=""><span style="color:#86E1FC">#include</span><span style="color:#86E1FC"> &#x3C;</span><span style="color:#C3E88D">List.hpp</span><span style="color:#86E1FC">></span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFC777">MFRC522</span><span style="color:#82AAFF"> mfrc522</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">SS_PIN</span><span style="color:#86E1FC">,</span><span style="color:#FFC777"> RST_PIN</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">MFRC522</span><span style="color:#86E1FC">::</span><span style="color:#C8D3F5">MIFARE_Key key</span><span style="color:#86E1FC">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">// 스위치 버튼 객체 생성</span></span>
<span data-line=""><span style="color:#FFC777">SwitchButton</span><span style="color:#82AAFF"> switchButton</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">SWITCH_PIN</span><span style="color:#86E1FC">,</span><span style="color:#FF966C"> 50</span><span style="color:#86E1FC">);</span><span style="color:#858AA6">  // 핀 번호, debounce delay (ms)</span></span>
<span data-line=""><span style="color:#858AA6">// 등록된 카드 UID 리스트</span></span>
<span data-line=""><span style="color:#C8D3F5">List</span><span style="color:#86E1FC">&#x3C;</span><span style="color:#C8D3F5">CardUID</span><span style="color:#86E1FC">></span><span style="color:#C8D3F5"> registeredUIDs</span><span style="color:#86E1FC">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> setup</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#858AA6">  // RFID 초기화</span></span>
<span data-line=""><span style="color:#82AAFF">  initRFIDCard</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> key</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">void</span><span style="color:#82AAFF"> loop</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#858AA6">  // 새 카드가 감지되었는지 확인</span></span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> (!</span><span style="color:#82AAFF">isCardPresent</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">mfrc522</span><span style="color:#86E1FC">))</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#86E1FC">    return;</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"\n</span><span style="color:#C3E88D">카드 감지! </span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#82AAFF">  printUID</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">mfrc522</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 현재 카드의 UID 가져오기</span></span>
<span data-line=""><span style="color:#C8D3F5">  CardUID currentUID </span><span style="color:#86E1FC">=</span><span style="color:#82AAFF"> getCurrentCardUID</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">mfrc522</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // ===== writeToBlock / readFromBlock 사용 예시 =====</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 안전한 블록 찾기</span></span>
<span data-line=""><span style="color:#C8D3F5">  byte blockAddr </span><span style="color:#86E1FC">=</span><span style="color:#82AAFF"> findNextSafeBlock</span><span style="color:#86E1FC">(</span><span style="color:#FF966C">1</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">  if</span><span style="color:#86E1FC"> (</span><span style="color:#C8D3F5">blockAddr </span><span style="color:#86E1FC">==</span><span style="color:#FF966C"> 255</span><span style="color:#86E1FC">)</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#FFC777">    Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">사용 가능한 블록이 없습니다.</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#82AAFF">    haltCard</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">mfrc522</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">    return;</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 예시 1: 간단한 정수 저장/읽기</span></span>
<span data-line=""><span style="color:#C099FF">  int</span><span style="color:#C8D3F5"> score </span><span style="color:#86E1FC">=</span><span style="color:#FF966C"> 100</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#82AAFF">  writeToBlock</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> key</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> blockAddr</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> score</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">  int</span><span style="color:#C8D3F5"> readScore</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#82AAFF">  readFromBlock</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> key</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> blockAddr</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> &#x26;</span><span style="color:#C8D3F5">readScore</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">점수: </span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">readScore</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#858AA6">  // 예시 2: 간단한 구조체 저장/읽기</span></span>
<span data-line=""><span style="color:#C099FF">  struct</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">    byte age</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#C099FF">    char</span><span style="color:#FFC777"> name</span><span style="color:#86E1FC">[</span><span style="color:#FF966C">10</span><span style="color:#86E1FC">];</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span><span style="color:#B4C2F0"> person </span><span style="color:#86E1FC">=</span><span style="color:#86E1FC"> {</span><span style="color:#FF966C">25</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> "</span><span style="color:#C3E88D">John</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">};</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C8D3F5">  byte nextBlock </span><span style="color:#86E1FC">=</span><span style="color:#82AAFF"> findNextSafeBlock</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">blockAddr </span><span style="color:#86E1FC">+</span><span style="color:#FF966C"> 1</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#82AAFF">  writeToBlock</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> key</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> nextBlock</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> person</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C099FF">  struct</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#B4C2F0">    byte age</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#C099FF">    char</span><span style="color:#FFC777"> name</span><span style="color:#86E1FC">[</span><span style="color:#FF966C">10</span><span style="color:#86E1FC">];</span></span>
<span data-line=""><span style="color:#86E1FC">  }</span><span style="color:#B4C2F0"> readPerson</span><span style="color:#86E1FC">;</span></span>
<span data-line=""><span style="color:#82AAFF">  readFromBlock</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">mfrc522</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> key</span><span style="color:#86E1FC">,</span><span style="color:#C8D3F5"> nextBlock</span><span style="color:#86E1FC">,</span><span style="color:#86E1FC"> &#x26;</span><span style="color:#C8D3F5">readPerson</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">나이: </span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">readPerson</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">age</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">print</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"</span><span style="color:#C3E88D">이름: </span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#FFC777">readPerson</span><span style="color:#86E1FC">.</span><span style="color:#A9B8E8">name</span><span style="color:#86E1FC">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#82AAFF">  haltCard</span><span style="color:#86E1FC">(</span><span style="color:#C8D3F5">mfrc522</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#FFC777">  Serial</span><span style="color:#86E1FC">.</span><span style="color:#82AAFF">println</span><span style="color:#86E1FC">(</span><span style="color:#86E1FC">"\n</span><span style="color:#C3E88D">다음 카드를 태그하세요...</span><span style="color:#86E1FC">"</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#82AAFF">  delay</span><span style="color:#86E1FC">(</span><span style="color:#FF966C">1000</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="#include &#x22;RFIDCard.h&#x22;
#include <List.hpp>

MFRC522 mfrc522(SS_PIN, RST_PIN);
MFRC522::MIFARE_Key key;

// 스위치 버튼 객체 생성
SwitchButton switchButton(SWITCH_PIN, 50);  // 핀 번호, debounce delay (ms)
// 등록된 카드 UID 리스트
List<CardUID> registeredUIDs;

void setup() {
  // RFID 초기화
  initRFIDCard(mfrc522, key);
}

void loop() {
  // 새 카드가 감지되었는지 확인
  if (!isCardPresent(mfrc522)) {
    return;
  }

  Serial.print(&#x22;\n카드 감지! &#x22;);
  printUID(mfrc522);

  // 현재 카드의 UID 가져오기
  CardUID currentUID = getCurrentCardUID(mfrc522);

  // ===== writeToBlock / readFromBlock 사용 예시 =====

  // 안전한 블록 찾기
  byte blockAddr = findNextSafeBlock(1);
  if (blockAddr == 255) {
    Serial.println(&#x22;사용 가능한 블록이 없습니다.&#x22;);
    haltCard(mfrc522);
    return;
  }

  // 예시 1: 간단한 정수 저장/읽기
  int score = 100;
  writeToBlock(mfrc522, key, blockAddr, score);

  int readScore;
  readFromBlock(mfrc522, key, blockAddr, &#x26;readScore);
  Serial.print(&#x22;점수: &#x22;);
  Serial.println(readScore);

  // 예시 2: 간단한 구조체 저장/읽기
  struct {
    byte age;
    char name[10];
  } person = {25, &#x22;John&#x22;};

  byte nextBlock = findNextSafeBlock(blockAddr + 1);
  writeToBlock(mfrc522, key, nextBlock, person);

  struct {
    byte age;
    char name[10];
  } readPerson;
  readFromBlock(mfrc522, key, nextBlock, &#x26;readPerson);
  Serial.print(&#x22;나이: &#x22;);
  Serial.println(readPerson.age);
  Serial.print(&#x22;이름: &#x22;);
  Serial.println(readPerson.name);

  haltCard(mfrc522);
  Serial.println(&#x22;\n다음 카드를 태그하세요...&#x22;);
  delay(1000);
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>9:["$","$L4","Arduino/rfid",{"post":{"metadata":{"title":"Arduino RFID","summary":"아두이노에서 RFID 리더기 사용법. MIFARE Classic 카드의 섹터, 블록 구조와 키 위치, 데이터 읽기/쓰기 방법 정리.","locale":"ko","createdAt":"2026-01-06T18:03:11.000Z","updatedAt":"2026-01-06T18:10:01.000Z"},"slug":"Arduino/rfid","source":"$11","type":"markdown","parentFolder":"Arduino"},"locale":"ko","delay":0.28}]
12:T2388,<h2 id="연결방법"><a class="heading-link" aria-hidden="true" href="#연결방법">연결방법</a></h2>
<p><code>+</code> 는 디지털핀 (아날로그 핀도 디지털용으로 가능), <code>-</code> 는 GND. 저항은 220옴</p>
<h2 id="코드"><a class="heading-link" aria-hidden="true" href="#코드">코드</a></h2>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c" data-theme="moonlight-ii"><code data-language="c" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#86E1FC">#define</span><span style="color:#82AAFF"> LED_PIN</span><span style="color:#FF966C"> 3</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFC777">void</span><span style="color:#82AAFF"> setup</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#65BCFF">	pinMode</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">LED_PIN</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> OUTPUT</span><span style="color:#86E1FC">)</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFC777">void</span><span style="color:#82AAFF"> loop</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#65BCFF">	digitalWrite</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">LED_PIN</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> HIGH</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="#define LED_PIN 3

void setup() {
	pinMode(LED_PIN, OUTPUT)
}

void loop() {
	digitalWrite(LED_PIN, HIGH);
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>
<h2 id="3색-led"><a class="heading-link" aria-hidden="true" href="#3색-led">3색 LED</a></h2>
<p>3색 LED 는 R, G, B 를 각각의 핀에 꼽는다.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1F2028;color:#c8d3f5" tabindex="0" data-language="c" data-theme="moonlight-ii"><code data-language="c" data-theme="moonlight-ii" style="display: grid;"><span data-line=""><span style="color:#86E1FC">#define</span><span style="color:#82AAFF"> RED</span><span style="color:#FF966C"> 9</span></span>
<span data-line=""><span style="color:#86E1FC">#define</span><span style="color:#82AAFF"> GREEN</span><span style="color:#FF966C"> 10</span></span>
<span data-line=""><span style="color:#86E1FC">#define</span><span style="color:#82AAFF"> BLUE</span><span style="color:#FF966C"> 11</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFC777">void</span><span style="color:#82AAFF"> setup</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#65BCFF">	pinMode</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">RED</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> OUTPUT</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#65BCFF">	pinMode</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">GREEN</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> OUTPUT</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#65BCFF">	pinMode</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">BLUE</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> OUTPUT</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FFC777">void</span><span style="color:#82AAFF"> loop</span><span style="color:#86E1FC">()</span><span style="color:#86E1FC"> {</span></span>
<span data-line=""><span style="color:#65BCFF">	digitalWrite</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">RED</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> HIGH</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#65BCFF">	digitalWrite</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">GREEN</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> HIGH</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#65BCFF">	digitalWrite</span><span style="color:#86E1FC">(</span><span style="color:#B4C2F0">BLUE</span><span style="color:#86E1FC">,</span><span style="color:#B4C2F0"> HIGH</span><span style="color:#86E1FC">);</span></span>
<span data-line=""><span style="color:#86E1FC">}</span></span><button type="button" title="Copy code" aria-label="Copy code" data="#define RED 9
#define GREEN 10
#define BLUE 11

void setup() {
	pinMode(RED, OUTPUT);
	pinMode(GREEN, OUTPUT);
	pinMode(BLUE, OUTPUT);
}

void loop() {
	digitalWrite(RED, HIGH);
	digitalWrite(GREEN, HIGH);
	digitalWrite(BLUE, HIGH);
}" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}pre button.rehype-pretty-copy { opacity: 0; }figure[data-rehype-pretty-code-figure]:hover > pre > code button.rehype-pretty-copy {opacity: 1;}</style></code></pre></figure>a:["$","$L4","Arduino/led.ko.",{"post":{"metadata":{"title":"Arduino LED","summary":"아두이노 LED 연결 방법과 제어 코드. 기본 LED와 3색 LED의 pinMode, digitalWrite 사용법 정리.","createdAt":"2026-01-05T08:42:29.000Z","updatedAt":"2026-01-05T08:42:29.000Z"},"slug":"Arduino/led.ko.","source":"$12","type":"markdown","parentFolder":"Arduino"},"locale":"ko","delay":0.33}]
b:null
c:["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/911e6a603adbdfb3.css","precedence":"next"}]
d:["$","$L13",null,{"children":["$","$14",null,{"name":"Next.MetadataOutlet","children":"$@15"}]}]
15:null
